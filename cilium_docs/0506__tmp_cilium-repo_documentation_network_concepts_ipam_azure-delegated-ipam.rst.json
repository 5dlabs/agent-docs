{
  "url": "file:///tmp/cilium-repo/Documentation/network/concepts/ipam/azure-delegated-ipam.rst",
  "content": ".. only:: not (epub or latex or html)\n\n    WARNING: You are looking at unreleased Cilium documentation.\n    Please use the official rendered version released here:\n    https://docs.cilium.io\n\n.. _azure_delegated_ipam:\n\n####################\nAzure Delegated IPAM\n####################\n\nThe Azure CNI powered by Cilium cluster utilizes a delegated IPAM (IP Address Manager) approach to allocate \nIP addresses for pods that are created using the Cilium CNI. This delegated IPAM component manages IP allocation \nwithin individual nodes of the cluster. It collaborates closely with the AKS (Azure Kubernetes Service) control plane \ncomponents to seamlessly integrate with the broader Azure Virtual Network stack. \n\n************\nArchitecture\n************\n\n.. image:: azure_delegated_ipam_arch.png\n    :align: center\n\nAzure Delegated Ipam allocator builds on top of CRD-backed allocator. AKS control plane creates ``NodeNetworkConfig`` \ncustom resource on each node matching node name. This custom resource contains unique ip prefix for node ``status.primaryIP`` \nin overlay mode or block of unique IP addresses in PodSubnet mode. Delegated Ipam Agent running on each node receives this resource and \nmanages the IP Allocation for pods within node. It makes sure IPs are programmed on Azure Network stack before \ngiving out IPs to Cilium CNI.\n\n********************\nCilium Configuration\n********************\n\nThe cilium agent must run with ``ipam: delegated-plugin``. Since cilium agent not managing IPs for pods, its also required \nto specify ``local-router-ipv4: 169.254.23.0`` to configure IP for ``cilium_host`` interface.\n\n************************\nCilium CNI Configuration\n************************\n\nCilium CNI is specifically configured with delegated IPAM details in its configuration, allowing it to interact \nwith the delegated Azure IPAM. This configuration ensures that the Cilium CNI triggers the delegated IPAM during \nboth pod addition and deletion operations. Upon receiving an Add request, the delegated IPAM allocates an available \nIP address from its cache. Similarly on a Delete request, the delegated IPAM marks the IP as available. \n\nThe following JSON snippet represents Cilium CNI config with Azure Delegated IPAM configuration.\n\n.. code-block:: json\n\n        {\n          \"cniVersion\": \"0.3.1\",\n          \"name\": \"cilium\",\n          \"plugins\": [\n            {\n              \"type\": \"cilium-cni\",\n              \"ipam\": {\n                \"type\": \"azure-ipam\"\n               },\n               \"enable-debug\": true,\n               \"log-file\": \"/var/log/cilium-cni.log\"\n            }\n          ]\n        }",
  "item_type": "unknown",
  "module_path": "/tmp/cilium-repo/Documentation/network/concepts/ipam/azure-delegated-ipam.rst",
  "extracted_at": "2025-09-03T01:13:29.211078Z"
}