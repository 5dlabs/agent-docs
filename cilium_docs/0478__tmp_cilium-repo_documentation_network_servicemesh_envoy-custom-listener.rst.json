{
  "url": "file:///tmp/cilium-repo/Documentation/network/servicemesh/envoy-custom-listener.rst",
  "content": ".. only:: not (epub or latex or html)\n\n    WARNING: You are looking at unreleased Cilium documentation.\n    Please use the official rendered version released here:\n    https://docs.cilium.io\n\n.. _gs_envoy_custom_listener:\n\n*******************\nL7 Path Translation\n*******************\n\nThis example replicates the Prometheus metrics listener which is\nalready available via the command line option ``--proxy-prometheus-port``.\nSo the point of this example is not to add new functionality, but to show\nhow a feature that previously required Cilium Agent code changes can be\nimplemented with the new Cilium Envoy Config CRD.\n\nApply Example CRD\n=================\n\nThis example adds a new Envoy listener ``envoy-prometheus-metrics-listener``\non the standard Prometheus port (e.g. ``9090``) to each Cilium node, translating\nthe default Prometheus metrics path ``/metrics`` to Envoy's Prometheus metrics path\n``/stats/prometheus``.\n\nApply this Cilium Envoy Config CRD:\n\n.. parsed-literal::\n\n    $ kubectl apply -f \\ |SCM_WEB|\\/examples/kubernetes/servicemesh/envoy/envoy-prometheus-metrics-listener.yaml\n\nThis version of the ``CiliumClusterwideEnvoyConfig`` CRD is Cluster-scoped,\n(i.e., not namespaced), so the name needs to be unique in the cluster,\nunless you want to replace a CRD with a new one.\n\n.. include:: warning.rst\n\n.. code-block:: shell-session\n\n    $ kubectl logs -n kube-system ds/cilium | grep -E \"level=(error|warning)\"\n\nTest the Listener Port\n======================\n\nTest that the new port is responding to the metrics requests:\n\n.. code-block:: shell-session\n\n    $ curl http://<node-IP>:9090/metrics\n\nWhere ``<node-IP>`` is the IP address of one of your k8s cluster nodes.\n\nClean-up\n========\n\nRemove the prometheus listener with:\n\n.. parsed-literal::\n\n    $ kubectl delete -f \\ |SCM_WEB|\\/examples/kubernetes/servicemesh/envoy/envoy-prometheus-metrics-listener.yaml\n",
  "item_type": "unknown",
  "module_path": "/tmp/cilium-repo/Documentation/network/servicemesh/envoy-custom-listener.rst",
  "extracted_at": "2025-09-03T01:13:29.168040Z"
}