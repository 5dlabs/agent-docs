{
  "url": "file:///tmp/cilium-repo/Documentation/network/kubernetes/ipam-crd.rst",
  "content": ".. only:: not (epub or latex or html)\n\n    WARNING: You are looking at unreleased Cilium documentation.\n    Please use the official rendered version released here:\n    https://docs.cilium.io\n\n.. _gsg_ipam_crd:\n\n***************\nCRD-Backed IPAM\n***************\n\nThis is a quick tutorial walking through how to enable CRD-backed IPAM. The\npurpose of this tutorial is to show how components are configured and resources\ninteract with each other to enable users to automate or extend on their own.\n\nFor more details, see the section :ref:`concepts_ipam_crd`\n\nEnable CRD IPAM mode\n====================\n\n#. Setup Cilium for Kubernetes using any of the available guides.\n#. Run Cilium with the ``--ipam=crd`` option or set ``ipam: crd`` in the\n   ``cilium-config`` ConfigMap.\n#. Restart Cilium. Cilium will automatically register the CRD if not available already\n\n   ::\n\n\t  msg=\"Waiting for initial IP to become available in 'k8s1' custom resource\" subsys=ipam\n\n#. Validate that the CRD has been registered:\n\n   .. code-block:: shell-session\n\n\t   $ kubectl get crds\n\t   NAME                              CREATED AT\n\t   [...]\n\t   ciliumnodes.cilium.io             2019-06-08T12:26:41Z\n\nCreate a CiliumNode CR\n======================\n\n#. Import the following custom resource to make IPs available in the Cilium agent.\n\n   .. code-block:: yaml\n\n           apiVersion: \"cilium.io/v2\"\n           kind: CiliumNode\n           metadata:\n             name: \"k8s1\"\n           spec:\n             ipam:\n               pool:\n                 192.168.1.1: {}\n                 192.168.1.2: {}\n                 192.168.1.3: {}\n                 192.168.1.4: {}\n\n#. Validate that Cilium has started up correctly\n\n   .. code-block:: shell-session\n\n           $ cilium-dbg status --all-addresses\n           KVStore:                Ok   etcd: 1/1 connected, has-quorum=true: https://192.168.60.11:2379 - 3.3.12 (Leader)\n           [...]\n           IPAM:                   IPv4: 2/4 allocated,\n           Allocated addresses:\n             192.168.1.1 (router)\n             192.168.1.3 (health)\n\n#. Validate the ``status.IPAM.used`` section:\n\n   .. code-block:: shell-session\n\n       $ kubectl get cn k8s1 -o yaml\n       apiVersion: cilium.io/v2\n       kind: CiliumNode\n       metadata:\n         name: k8s1\n         [...]\n       spec:\n         ipam:\n           pool:\n             192.168.1.1: {}\n             192.168.1.2: {}\n             192.168.1.3: {}\n             192.168.1.4: {}\n       status:\n         ipam:\n           used:\n             192.168.1.1:\n               owner: router\n             192.168.1.3:\n               owner: health\n\n.. note::\n\n    At the moment only single IP addresses are allowed. CIDR's are not supported.\n",
  "item_type": "unknown",
  "module_path": "/tmp/cilium-repo/Documentation/network/kubernetes/ipam-crd.rst",
  "extracted_at": "2025-09-03T01:13:29.244333Z"
}