{
  "url": "file:///tmp/cilium-repo/Documentation/installation/alibabacloud-eni.rst",
  "content": "To install Cilium on `ACK (Alibaba Cloud Container Service for Kubernetes) <https://www.alibabacloud.com/help/doc-detail/86745.htm>`_, perform the following steps:\n\n**Disable ACK CNI (ACK Only):**\n\nIf you are running an ACK cluster, you should delete the ACK CNI.\n\n.. only:: not (epub or latex or html)\n\n    WARNING: You are looking at unreleased Cilium documentation.\n    Please use the official rendered version released here:\n    https://docs.cilium.io\n\nCilium will manage ENIs instead of the ACK CNI, so any running DaemonSet from\nthe list below has to be deleted to prevent conflicts.\n\n- ``kube-flannel-ds``\n- ``terway``\n- ``terway-eni``\n- ``terway-eniip``\n\n.. note::\n\n    If you are using ACK with Flannel (DaemonSet ``kube-flannel-ds``),\n    the Cloud Controller Manager (CCM) will create a route (Pod CIDR) in VPC.\n    If your cluster is a Managed Kubernetes you cannot disable this behavior.\n    Please consider creating a new cluster.\n\n.. code-block:: shell-session\n\n   kubectl -n kube-system delete daemonset <terway>\n\nThe next step is to remove CRD below created by ``terway*`` CNI\n\n.. code-block:: shell-session\n\n    kubectl delete crd \\\n        ciliumclusterwidenetworkpolicies.cilium.io \\\n        ciliumendpoints.cilium.io \\\n        ciliumidentities.cilium.io \\\n        ciliumnetworkpolicies.cilium.io \\\n        ciliumnodes.cilium.io \\\n        bgpconfigurations.crd.projectcalico.org \\\n        clusterinformations.crd.projectcalico.org \\\n        felixconfigurations.crd.projectcalico.org \\\n        globalnetworkpolicies.crd.projectcalico.org \\\n        globalnetworksets.crd.projectcalico.org \\\n        hostendpoints.crd.projectcalico.org \\\n        ippools.crd.projectcalico.org \\\n        networkpolicies.crd.projectcalico.org\n\n\n**Create AlibabaCloud Secrets:**\n\nBefore installing Cilium, a new Kubernetes Secret with the AlibabaCloud Tokens needs to\nbe added to your Kubernetes cluster. This Secret will allow Cilium to gather\ninformation from the AlibabaCloud API which is needed to implement ToGroups policies.\n\n**AlibabaCloud Access Keys:**\n\nTo create a new access token the `following guide can be used\n<https://www.alibabacloud.com/help/doc-detail/93691.htm>`_.\nThese keys need to have certain `RAM Permissions\n<https://ram.console.aliyun.com/overview>`_:\n\n.. code-block:: json\n\n    {\n      \"Version\": \"1\",\n      \"Statement\": [{\n          \"Action\": [\n            \"ecs:CreateNetworkInterface\",\n            \"ecs:DescribeNetworkInterfaces\",\n            \"ecs:AttachNetworkInterface\",\n            \"ecs:DetachNetworkInterface\",\n            \"ecs:DeleteNetworkInterface\",\n            \"ecs:DescribeInstanceAttribute\",\n            \"ecs:DescribeInstanceTypes\",\n            \"ecs:AssignPrivateIpAddresses\",\n            \"ecs:UnassignPrivateIpAddresses\",\n            \"ecs:DescribeInstances\",\n            \"ecs:DescribeSecurityGroups\",\n            \"ecs:ListTagResources\"\n          ],\n          \"Resource\": [\n            \"*\"\n          ],\n          \"Effect\": \"Allow\"\n        },\n        {\n          \"Action\": [\n            \"vpc:DescribeVSwitches\",\n            \"vpc:ListTagResources\",\n            \"vpc:DescribeVpcs\"\n          ],\n          \"Resource\": [\n            \"*\"\n          ],\n          \"Effect\": \"Allow\"\n        }\n      ]\n    }\n\n\nAs soon as you have the access tokens, the following secret needs to be added,\nwith each empty string replaced by the associated value as a base64-encoded string:\n\n.. code-block:: yaml\n\n    apiVersion: v1\n    kind: Secret\n    metadata:\n      name: cilium-alibabacloud\n      namespace: kube-system\n    type: Opaque\n    data:\n      ALIBABA_CLOUD_ACCESS_KEY_ID: \"\"\n      ALIBABA_CLOUD_ACCESS_KEY_SECRET: \"\"\n\n\nThe base64 command line utility can be used to generate each value, for example:\n\n.. code-block:: shell-session\n\n    $ echo -n \"access_key\" | base64\n    YWNjZXNzX2tleQ==\n\nThis secret stores the AlibabaCloud credentials, which will be used to\nconnect to the AlibabaCloud API.\n\n.. code-block:: shell-session\n\n    $ kubectl create -f cilium-secret.yaml\n\n\n**Install Cilium:**\n\nInstall Cilium release via Helm:\n\n.. parsed-literal::\n\n   helm install cilium |CHART_RELEASE| \\\\\n     --namespace kube-system \\\\\n     --set alibabacloud.enabled=true \\\\\n     --set ipam.mode=alibabacloud \\\\\n     --set enableIPv4Masquerade=false \\\\\n     --set routingMode=native\n\n.. note::\n\n   You must ensure that the security groups associated with the ENIs (``eth1``,\n   ``eth2``, ...) allow for egress traffic to go outside of the VPC. By default,\n   the security groups for pod ENIs are derived from the primary ENI\n   (``eth0``).\n\n\n",
  "item_type": "unknown",
  "module_path": "/tmp/cilium-repo/Documentation/installation/alibabacloud-eni.rst",
  "extracted_at": "2025-09-03T01:13:29.300497Z"
}