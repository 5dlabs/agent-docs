{
  "url": "file:///tmp/cilium-repo/Documentation/installation/cni-chaining-weave.rst",
  "content": ".. only:: not (epub or latex or html)\n\n    WARNING: You are looking at unreleased Cilium documentation.\n    Please use the official rendered version released here:\n    https://docs.cilium.io\n\n*********\nWeave Net\n*********\n\nThis guide instructs how to install Cilium in chaining configuration on top of\n`Weave Net <https://github.com/weaveworks/weave>`_.\n\n.. include:: cni-chaining-limitations.rst\n\nCreate a CNI configuration\n==========================\n\nCreate a ``chaining.yaml`` file based on the following template to specify the\ndesired CNI chaining configuration:\n\n\n.. code-block:: yaml\n\n    apiVersion: v1\n    kind: ConfigMap\n    metadata:\n      name: cni-configuration\n      namespace: kube-system\n    data:\n      cni-config: |-\n        {\n            \"cniVersion\": \"0.3.1\",\n            \"name\": \"weave\",\n            \"plugins\": [\n                {\n                    \"name\": \"weave\",\n                    \"type\": \"weave-net\",\n                    \"hairpinMode\": true\n                },\n                {\n                    \"type\": \"portmap\",\n                    \"capabilities\": {\"portMappings\": true},\n                    \"snat\": true\n                },\n                {\n                    \"type\": \"cilium-cni\"\n                }\n            ]\n        }\n\nDeploy the :term:`ConfigMap`:\n\n.. code-block:: shell-session\n\n   kubectl apply -f chaining.yaml\n\nDeploy Cilium with the portmap plugin enabled\n=============================================\n\n.. include:: k8s-install-download-release.rst\n\nDeploy Cilium release via Helm:\n\n.. parsed-literal::\n\n    helm install cilium |CHART_RELEASE| \\\\\n      --namespace=kube-system \\\\\n      --set cni.chainingMode=generic-veth \\\\\n      --set cni.customConf=true \\\\\n      --set cni.configMap=cni-configuration \\\\\n      --set routingMode=native \\\\\n      --set enableIPv4Masquerade=false\n\n.. note::\n\n   The new CNI chaining configuration will *not* apply to any pod that is\n   already running the cluster. Existing pods will be reachable and Cilium will\n   load-balance to them but policy enforcement will not apply to them and\n   load-balancing is not performed for traffic originating from existing pods.\n\n   You must restart these pods in order to invoke the chaining configuration on\n   them.\n\n.. include:: k8s-install-validate.rst\n\n.. include:: next-steps.rst\n\n",
  "item_type": "unknown",
  "module_path": "/tmp/cilium-repo/Documentation/installation/cni-chaining-weave.rst",
  "extracted_at": "2025-09-03T01:13:29.307555Z"
}