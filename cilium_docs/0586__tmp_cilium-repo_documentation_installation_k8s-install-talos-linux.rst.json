{
  "url": "file:///tmp/cilium-repo/Documentation/installation/k8s-install-talos-linux.rst",
  "content": ".. only:: not (epub or latex or html)\n\n    WARNING: You are looking at unreleased Cilium documentation.\n    Please use the official rendered version released here:\n    https://docs.cilium.io\n\n.. _talos_linux_install:\n\n**Prerequisites / Limitations**\n\n  - Cilium's Talos Linux support is only tested with Talos versions ``>=1.5.0``.\n  - As Talos `does not allow loading Kernel modules`_ by Kubernetes workloads, ``SYS_MODULE`` needs to be dropped from the Cilium default capability list.\n  - Talos Linux's `Forwarding kube-dns to Host DNS`_ (enabled by default since Talos 1.8+) doesn't work together with Cilium's :ref:`eBPF_Host_Routing`. To make it work, you must set ``bpf.hostLegacyRouting`` to ``true`` as DNS won't work otherwise.\n\n.. _`does not allow loading Kernel modules`: https://www.talos.dev/latest/learn-more/process-capabilities/\n.. _`Forwarding kube-dns to Host DNS`: https://www.talos.dev/latest/talos-guides/network/host-dns/#forwarding-kube-dns-to-host-dns\n\n.. note::\n\n    The official Talos Linux documentation already covers many different Cilium deployment\n    options inside their `Deploying Cilium CNI guide`_. Thus, this guide will only focus on\n    the most recommended deployment option, from a Cilium perspective:\n\n    - Deployment via official `Cilium Helm chart`_\n    - Cilium `Kube-Proxy replacement<kubeproxy-free>` enabled\n    - Reuse the ``cgroupv2`` mount that Talos already provides\n    - `Kubernetes Host Scope<k8s_hostscope>` IPAM mode as Talos, by default, assigns ``PodCIDRs`` to ``v1.Node`` resources\n\n.. _`Cilium Helm chart`: https://github.com/cilium/charts\n.. _`Deploying Cilium CNI guide`: https://www.talos.dev/latest/kubernetes-guides/network/deploying-cilium/\n\n**Configure Talos Linux**\n\nBefore installing Cilium, there are two `Talos Linux Kubernetes configurations`_ that\nneed to be adjusted:\n\n#. Ensuring no other CNI is deployed via ``cluster.network.cni.name: none``\n#. Disabling Kube-Proxy deployment via ``cluster.proxy.disabled: true``\n\nPrepare a ``patch.yaml`` file:\n\n.. code-block:: yaml\n\n    cluster:\n      network:\n        cni:\n          name: none\n      proxy:\n        disabled: true\n\nNext, generate the configuration files for the Talos cluster by using the\n``talosctl gen config`` command:\n\n.. code-block:: shell-session\n\n    talosctl gen config \\\n      my-cluster https://mycluster.local:6443 \\\n      --config-patch @patch.yaml\n\n.. _`Talos Linux Kubernetes configurations`: https://www.talos.dev/latest/reference/configuration/v1alpha1/config/#Config.cluster\n\n**Install Cilium**\n\nTo run Cilium with `Kube-Proxy replacement<kubeproxy-free>` enabled, it's required\nto configure ``k8sServiceHost`` and ``k8sServicePort``, and point them to the\nKubernetes API. Luckily, Talos Linux provides KubePrism_ which allows it to access\nthe Kubernetes API in a convenient way, which solely relies on host networking without\nusing an external loadbalancer. This KubePrism_ endpoint can be accessed from every\nTalos Linux node on ``localhost:7445``.\n\n.. parsed-literal::\n\n    helm install cilium |CHART_RELEASE| \\\\\n      --namespace $CILIUM_NAMESPACE \\\\\n      --set=ipam.mode=kubernetes \\\\\n      --set=kubeProxyReplacement=true \\\\\n      --set=securityContext.capabilities.ciliumAgent=\"{CHOWN,KILL,NET_ADMIN,NET_RAW,IPC_LOCK,SYS_ADMIN,SYS_RESOURCE,DAC_OVERRIDE,FOWNER,SETGID,SETUID}\" \\\\\n      --set=securityContext.capabilities.cleanCiliumState=\"{NET_ADMIN,SYS_ADMIN,SYS_RESOURCE}\" \\\\\n      --set=cgroup.autoMount.enabled=false \\\\\n      --set=cgroup.hostRoot=/sys/fs/cgroup \\\\\n      --set=k8sServiceHost=localhost \\\\\n      --set=k8sServicePort=7445\n\n.. _KubePrism: https://www.talos.dev/v1.6/kubernetes-guides/configuration/kubeprism/",
  "item_type": "unknown",
  "module_path": "/tmp/cilium-repo/Documentation/installation/k8s-install-talos-linux.rst",
  "extracted_at": "2025-09-03T01:13:29.313692Z"
}