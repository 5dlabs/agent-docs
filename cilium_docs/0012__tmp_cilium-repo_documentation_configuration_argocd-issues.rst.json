{
  "url": "file:///tmp/cilium-repo/Documentation/configuration/argocd-issues.rst",
  "content": ".. only:: not (epub or latex or html)\n\n    WARNING: You are looking at unreleased Cilium documentation.\n    Please use the official rendered version released here:\n    https://docs.cilium.io\n\n.. _argocd_issues:\n\n********************************************\nTroubleshooting Cilium deployed with Argo CD\n********************************************\n\nThere have been reports from users hitting issues with Argo CD. This documentation \npage outlines some of the known issues and their solutions.\n\nArgo CD deletes CustomResourceDefinitions\n=========================================\n\nWhen deploying Cilium with Argo CD, some users have reported that Cilium-generated custom resources disappear,\ncausing one or more of the following issues:\n\n- ``ciliumid`` not found (:gh-issue:`17614`)\n- Argo CD Out-of-sync issues for hubble-generate-certs (:gh-issue:`14550`)\n- Out-of-sync issues for Cilium using Argo CD (:gh-issue:`18298`)\n\nSolution\n--------\n\nTo prevent these issues, declare resource exclusions in the Argo CD ``ConfigMap`` by following `these instructions <https://argo-cd.readthedocs.io/en/stable/operator-manual/declarative-setup/#resource-exclusioninclusion>`__.\n\nHere is an example snippet:\n\n.. code-block:: yaml\n\n    resource.exclusions: |\n     - apiGroups:\n         - cilium.io\n       kinds:\n         - CiliumIdentity\n       clusters:\n         - \"*\"\n\n\nAlso, it has been reported that the problem may affect all workloads you deploy with Argo CD in a cluster running Cilium, not just Cilium itself.\nIf so, you will need the following exclusions in your Argo CD application definition to avoid getting “out of sync” when Hubble rotates its certificates.\n\n.. code-block:: yaml\n\n    ignoreDifferences:\n      - group: \"\"\n        kind: ConfigMap\n        name: hubble-ca-cert\n        jsonPointers:\n        - /data/ca.crt\n      - group: \"\"\n        kind: Secret\n        name: hubble-relay-client-certs\n        jsonPointers:\n        - /data/ca.crt\n        - /data/tls.crt\n        - /data/tls.key\n      - group: \"\"\n        kind: Secret\n        name: hubble-server-certs\n        jsonPointers:\n        - /data/ca.crt\n        - /data/tls.crt\n        - /data/tls.key\n\n\n.. note::\n    After applying the above configurations, for the settings to take effect, you will need to restart the Argo CD deployments.\n\nHelm template with serviceMonitor enabled fails\n===============================================\n\nSome users have reported that when they install Cilium using Argo CD and run ``helm template`` with ``serviceMonitor`` enabled, it fails.\nIt fails because Argo CD CLI doesn't pass the ``--api-versions`` flag to Helm upon deployment.\n\nSolution\n--------\n\nThis `pull request <https://github.com/argoproj/argo-cd/pull/8371>`__ fixed this issue in Argo CD's `v2.3.0 release <https://github.com/argoproj/argo-cd/releases/tag/v2.3.0>`__.\nUpgrade your Argo CD and check if ``helm template`` with ``serviceMonitor`` enabled still fails.\n\n.. note::\n\n    When using ``helm template``, it is highly recommended you set\n    ``--kube-version`` and ``--api-versions`` with the values matching your\n    target Kubernetes cluster. Helm charts such as Cilium's often conditionally\n    enable certain Kubernetes features based on their availability (beta vs\n    stable) on the target cluster.\n\n    By specifying ``--api-versions=monitoring.coreos.com/v1`` you should be\n    able to pass validation with ``helm template``.\n\nIf you have an issue with Argo CD that's not outlined above, check this `list\nof Argo CD related issues on GitHub\n<https://github.com/cilium/cilium/issues?q=is%3Aissue+argocd>`__.\nIf you can't find an issue that relates to yours, create one and/or seek help\non `Cilium Slack`_.\n\nApplication chart for Cilium deployed to Talos Linux fails with: field not declared in schema\n=============================================================================================\n\nWhen deploying Cilium to Talos Linux with ArgoCD, some users have reported\nissues due to Talos Security configuration. ArgoCD may fail to deploy the\napplication with the message::\n\n    Failed to compare desired state to live state: failed to calculate diff:\n    error calculating structured merge diff: error building typed value from live\n    resource: .spec.template.spec.securityContext.appArmorProfile: field not\n    declared in schema\n\nSolution\n--------\n\nAdd option ``ServerSideApply=true`` to list ``syncPolicy.syncOptions`` for the Application.\n\n.. code-block:: yaml\n\n    apiVersion: argoproj.io/v1alpha1\n    kind: Application\n    spec:\n      syncPolicy:\n        syncOptions:\n        - ServerSideApply=true\n\nVisit the `ArgoCD documentation <https://argo-cd.readthedocs.io/en/stable/user-guide/sync-options/#server-side-apply>`__ for further details.\n",
  "item_type": "unknown",
  "module_path": "/tmp/cilium-repo/Documentation/configuration/argocd-issues.rst",
  "extracted_at": "2025-09-03T01:13:28.729432Z"
}