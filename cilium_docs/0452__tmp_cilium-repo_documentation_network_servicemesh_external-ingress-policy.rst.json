{
  "url": "file:///tmp/cilium-repo/Documentation/network/servicemesh/external-ingress-policy.rst",
  "content": ".. only:: not (epub or latex or html) \n WARNING: You are looking at unreleased Cilium documentation.\nPlease use the official rendered version released here:\nhttps://docs.cilium.io\n \n \n External Lock-down Policy \n \n By default, all the external traffic is allowed. Let's apply a  CiliumNetworkPolicy  to lock down external traffic. \n .. literalinclude:: ../../../examples/kubernetes/servicemesh/policy/external-lockdown.yaml\n:language: yaml \n .. parsed-literal:: \n $ kubectl apply -f \\ |SCM_WEB|\\/examples/kubernetes/servicemesh/policy/external-lockdown.yaml\n \n With this policy applied, any request originating from outside the cluster will be rejected with a  403 Forbidden \n .. code-block:: shell-session \n $ curl --fail -v http://\"$HTTP_INGRESS\"/details/1\n*   Trying 172.18.255.194:80...\n* Connected to 172.18.255.194 (172.18.255.194) port 80\n> GET /details/1 HTTP/1.1\n> Host: 172.18.255.194\n> User-Agent: curl/8.6.0\n> Accept: */*\n>\n< HTTP/1.1 403 Forbidden\n< content-length: 15\n< content-type: text/plain\n< date: Thu, 29 Feb 2024 12:59:54 GMT\n< server: envoy\n* The requested URL returned error: 403\n* Closing connection\ncurl: (22) The requested URL returned error: 403\n\n# Capture hubble flows in another terminal\n$ kubectl --namespace=kube-system exec -i -t cilium-xjl4x -- hubble observe -f --identity ingress\nDefaulted container \"cilium-agent\" out of: cilium-agent, config (init), mount-cgroup (init), apply-sysctl-overwrites (init), mount-bpf-fs (init), wait-for-node-init (init), clean-cilium-state (init), install-cni-binaries (init)\nFeb 29 13:00:29.389: 172.18.0.1:53866 (ingress) -> kube-system/cilium-ingress:80 (world) http-request DROPPED (HTTP/1.1 GET http://172.18.255.194/details/1)\nFeb 29 13:00:29.389: 172.18.0.1:53866 (ingress) <- kube-system/cilium-ingress:80 (world) http-response FORWARDED (HTTP/1.1 403 0ms (GET http://172.18.255.194/details/1))\n \n Let's check if in-cluster traffic to the Ingress endpoint is still allowed: \n .. parsed-literal:: \n # The test-application.yaml contains a client pod with curl available\n$ kubectl apply -f \\ |SCM_WEB|\\/examples/kubernetes/servicemesh/envoy/test-application.yaml\n$ kubectl exec -it deployment/client -- curl -s http://$HTTP_INGRESS/details/1\n{\"id\":1,\"author\":\"William Shakespeare\",\"year\":1595,\"type\":\"paperback\",\"pages\":200,\"publisher\":\"PublisherA\",\"language\":\"English\",\"ISBN-10\":\"1234567890\",\"ISBN-13\":\"123-1234567890\"}%\n \n Another common use case is to allow only a specific set of IP addresses to access the Ingress. This can be achieved via\nthe below policy \n .. literalinclude:: ../../../examples/kubernetes/servicemesh/policy/allow-ingress-cidr.yaml\n:language: yaml \n .. parsed-literal:: \n $ kubectl apply -f \\ |SCM_WEB|\\/examples/kubernetes/servicemesh/policy/allow-ingress-cidr.yaml\n \n .. code-block:: shell-session \n $ curl -s --fail http://\"$HTTP_INGRESS\"/details/1\n{\"id\":1,\"author\":\"William Shakespeare\",\"year\":1595,\"type\":\"paperback\",\"pages\":200,\"publisher\":\"PublisherA\",\"language\":\"English\",\"ISBN-10\":\"1234567890\",\"ISBN-13\":\"123-1234567890\"}",
  "item_type": "unknown",
  "module_path": "/tmp/cilium-repo/Documentation/network/servicemesh/external-ingress-policy.rst",
  "extracted_at": "2025-09-03T01:13:29.146972Z"
}