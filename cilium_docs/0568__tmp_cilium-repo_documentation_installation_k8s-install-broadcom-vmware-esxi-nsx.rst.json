{
  "url": "file:///tmp/cilium-repo/Documentation/installation/k8s-install-broadcom-vmware-esxi-nsx.rst",
  "content": ".. only:: not (epub or latex or html)\n\n    WARNING: You are looking at unreleased Cilium documentation.\n    Please use the official rendered version released here:\n    https://docs.cilium.io\n\n.. _k8s_install_broadcom_vmware_esxi_nsx:\n\n******************************************\nInstallation on Broadcom VMware ESXi / NSX\n******************************************\n\nCilium can be installed on VMware ESXi with or without NSX by using official image.\n\nDeploying Cilium on Broadcom VMware vSphere ESXi with or without NSX(-T)\n========================================================================\n\nCilium can be deployed on VMware vSphere ESXi, with or without NSX(-T).\nHowever, there are known issues when using tunnel mode with VXLAN as the encapsulation.\n\n.. tabs::\n\n    .. group-tab:: VXLAN\n\n        Install Cilium via ``helm install`` with VXLAN Protocol\n\n        .. parsed-literal::\n\n            helm install cilium |CHART_RELEASE| \\\\\n                --namespace kube-system \\\\\n                --set image.pullPolicy=IfNotPresent \\\\\n                --set ipam.mode=kubernetes \\\\\n                --set tunnelProtocol=vxlan\n\n        .. note::\n\n            With NSX(-T), use a custom port for the ``tunnelPort`` flag, for instance ``--set tunnelPort=8223``. :gh-issue:`21801`\n            tracks some reports of problems with offloads when using the VXLAN UDP port standard (4789) or draft (8472).\n\n    .. group-tab:: Geneve\n\n        Install Cilium via ``helm install`` with Geneve Protocol\n\n        .. parsed-literal::\n\n            helm install cilium |CHART_RELEASE| \\\\\n                --namespace kube-system \\\\\n                --set image.pullPolicy=IfNotPresent \\\\\n                --set ipam.mode=kubernetes \\\\\n                --set tunnelProtocol=geneve\n\n        .. note::\n\n            NSX(-T) with Network Virtualization (with Edge T0/T1) also uses Geneve Protocol between Transport Nodes (ESXi, Edge).\n            Be aware when troubleshooting that the Geneve traffic you observe on the network may be generated by either NSX(-T) or Cilium.\n\n\nTroubleshooting\n===============\n\nPod Communication Failure Across Hosts\n--------------------------------------\n\nWhen deploying Cilium with some old release ESXi (7) or with NSX-T (3.x/4.x), with VXLAN encapsulation, the inter-host pod communication may fail, except for ICMP (ping), which still functions.\n\nIn the :ref:`Cilium-health status <cluster_connectivity_health>` you will see:\n\n.. code-block:: shell-session\n\n    ==== detail from pod cilium-mvrb6 , on node alg-cilium-cp\n    Probe time:   2025-03-12T16:55:02Z\n    Nodes:\n    alg-cilium-cp (localhost):\n        Host connectivity to 10.44.144.20:\n        ICMP to stack:   OK, RTT=640.959µs\n        HTTP to agent:   OK, RTT=148.15µs\n        Endpoint connectivity to 10.42.0.38:\n        ICMP to stack:   OK, RTT=632.181µs\n        HTTP to agent:   OK, RTT=295.409µs\n    alg-cilium-wk1:\n        Host connectivity to 10.44.144.21:\n        ICMP to stack:   OK, RTT=764.463µs\n        HTTP to agent:   OK, RTT=1.154573ms\n        Endpoint connectivity to 10.42.4.211:\n        ICMP to stack:   OK, RTT=765.081µs\n        HTTP to agent:   Get \"http://10.42.4.211:4240/hello\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\n\n\nThe problem originates from a `bug in the VMXNET3 driver <https://knowledge.broadcom.com/external/article/324199/vm-vxlan-traffic-fails-on-a-host-prepare.html>`__ \nrelated to NIC offload support for VXLAN encapsulation. This is due to the use of an outdated standard port (8472) for VXLAN.\n\nIn this case you need to change to VXLAN Port ``--set tunnelPort=8223`` or use Geneve tunnel Protocol ``--set tunnelProtocol=geneve``.\nThere is some workaround about `Disable NIC Offload <https://github.com/cilium/cilium/issues/21801>`__ but it is not recommended solution.\n",
  "item_type": "unknown",
  "module_path": "/tmp/cilium-repo/Documentation/installation/k8s-install-broadcom-vmware-esxi-nsx.rst",
  "extracted_at": "2025-09-03T01:13:29.306545Z"
}