{
  "url": "file:///tmp/cilium-repo/Documentation/installation/k8s-install-external-etcd.rst",
  "content": ".. only:: not (epub or latex or html)\n\n    WARNING: You are looking at unreleased Cilium documentation.\n    Please use the official rendered version released here:\n    https://docs.cilium.io\n\n.. _admin_install_daemonset:\n.. _k8s_install_etcd:\n\n*******************************\nInstallation with external etcd\n*******************************\n\nThis guide walks you through the steps required to set up Cilium on Kubernetes\nusing an external etcd. Use of an external etcd provides better performance and\nis suitable for larger environments.\n\nShould you encounter any issues during the installation, please refer to the\n:ref:`troubleshooting_k8s` section and/or seek help on `Cilium Slack`_.\n\nWhen do I need to use a kvstore?\n================================\n\nUnlike the section :ref:`k8s_quick_install`, this guide explains how to\nconfigure Cilium to use an external kvstore such as etcd. If you are unsure\nwhether you need to use a kvstore at all, the following is a list of reasons\nwhen to use a kvstore:\n\n * If you are running in an environment where you observe a high overhead in\n   state propagation caused by Kubernetes events.\n * If you do not want Cilium to store state in Kubernetes custom resources\n   (CRDs).\n * If you run a cluster with more pods and more nodes than the ones tested\n   in the :ref:`scalability_guide`.\n\n.. _ds_deploy:\n\n.. include:: requirements-intro.rst\n\nYou will also need an external etcd version 3.4.0 or higher.\n\nKvstore and Cilium dependency\n=============================\nWhen using an external kvstore, it's important to break the circular dependency between Cilium and kvstore.\nIf kvstore pods are running within the same cluster and are using a pod network then kvstore relies on Cilium.\nHowever, Cilium also relies on the kvstore, which creates a circular dependency.\nThere are two recommended ways of breaking this dependency:\n\n * Deploy kvstore outside of cluster or on separately managed cluster.\n * Deploy kvstore pods with a host network, by specifying ``hostNetwork: true`` in the pod spec.\n\nConfigure Cilium\n===========================\n\nWhen using an external kvstore, the address of the external kvstore needs to be\nconfigured in the ConfigMap. Download the base YAML and configure it with\n:term:`Helm`:\n\n.. include:: k8s-install-download-release.rst\n\nDeploy Cilium release via Helm:\n\n.. parsed-literal::\n\n    helm install cilium |CHART_RELEASE| \\\\\n      --namespace kube-system \\\\\n      --set etcd.enabled=true \\\\\n      --set \"etcd.endpoints[0]=http://etcd-endpoint1:2379\" \\\\\n      --set \"etcd.endpoints[1]=http://etcd-endpoint2:2379\" \\\\\n      --set \"etcd.endpoints[2]=http://etcd-endpoint3:2379\"\n\nIf you do not want Cilium to store state in Kubernetes custom resources (CRDs),\nconsider setting ``identityAllocationMode``::\n\n    --set identityAllocationMode=kvstore\n\n\nOptional: Configure the SSL certificates\n----------------------------------------\n\nCreate a Kubernetes secret with the root certificate authority, and client-side\nkey and certificate of etcd:\n\n.. code-block:: shell-session\n\n    kubectl create secret generic -n kube-system cilium-etcd-secrets \\\n        --from-file=etcd-client-ca.crt=ca.crt \\\n        --from-file=etcd-client.key=client.key \\\n        --from-file=etcd-client.crt=client.crt\n\nAdjust the helm template generation to enable SSL for etcd and use https instead\nof http for the etcd endpoint URLs:\n\n.. parsed-literal::\n\n    helm install cilium |CHART_RELEASE| \\\\\n      --namespace kube-system \\\\\n      --set etcd.enabled=true \\\\\n      --set etcd.ssl=true \\\\\n      --set \"etcd.endpoints[0]=https://etcd-endpoint1:2379\" \\\\\n      --set \"etcd.endpoints[1]=https://etcd-endpoint2:2379\" \\\\\n      --set \"etcd.endpoints[2]=https://etcd-endpoint3:2379\"\n\n.. include:: k8s-install-validate.rst\n\n.. include:: next-steps.rst\n",
  "item_type": "unknown",
  "module_path": "/tmp/cilium-repo/Documentation/installation/k8s-install-external-etcd.rst",
  "extracted_at": "2025-09-03T01:13:29.305936Z"
}