{
  "url": "file:///tmp/cilium-repo/Documentation/contributing/development/bgp_cplane.rst",
  "content": ".. only:: not (epub or latex or html)\n\n    WARNING: You are looking at unreleased Cilium documentation.\n    Please use the official rendered version released here:\n    https://docs.cilium.io\n\n\n.. _bgp_cplane_contributing:\n\n=================\nBGP Control Plane\n=================\n\nThis section is specific to :ref:`bgp_control_plane` contributions.\n\nDevelopment Environment\n=======================\n\nBGP Control Plane requires a BGP peer for testing. This section describes a `ContainerLab`_ and `Kind`_-based development environment. The following diagram shows the topology:\n\n.. _ContainerLab: https://containerlab.dev/\n.. _Kind: https://kind.sigs.k8s.io/\n\n.. image:: _static/bgp-lab.drawio.png\n    :align: center\n\nThe following describes the role of each node:\n\n* ``router0`` is an `FRRouting (FRR)`_ router. It is pre-configured with minimal peering settings with server0 and server1.\n* ``server0`` and ``server1`` are ``nicolaka/netshoot`` containers that each share a network namespace with their own Kind node.\n* ``server2`` is a non-Cilium ``nicolaka/netshoot`` node useful for testing traffic connectivity from outside of the k8s cluster.\n\n.. _FRRouting (FRR): https://frrouting.org/\n\nPrerequisites\n-------------\n\n* ContainerLab v0.45.1 or later\n* Kind v0.20.0 or later\n* Your container runtime networks must not use ``10.0.0.0/8`` and ``fd00::/16``\n\nDeploy Lab\n----------\n\n.. code-block:: shell-session\n\n   $ make kind-bgp-v4\n\n.. note::\n        The prior example sets up an IPv4 single-stack environment. You can change the ``v4`` part to ``v6`` or ``dual`` to set up an IPv6 single-stack or dual-stack environment respectively. The same goes for the following examples.\n\nInstall Cilium on the Lab\n-------------------------\n\nInstall Cilium on the lab with your favorite way. The following example assumes you are modifying the source and want to build your own image. The minimal mandatory Helm values are provided in ``contrib/containerlab/bgp-cplane-dev-v4/values.yaml``. If needed, you can add Helm values to deploy BGP Control Plane with a different Cilium configuration.\n\n.. code-block:: shell-session\n\n   $ KIND_CLUSTER_NAME=bgp-cplane-dev-v4 make kind-image\n   $ cilium install --chart-directory install/kubernetes/cilium -f contrib/containerlab/bgp-cplane-dev-v4/values.yaml --set image.override=\"localhost:5000/cilium/cilium-dev:local\" --set image.pullPolicy=Never --set operator.image.override=\"localhost:5000/cilium/operator-generic:local\" --set operator.image.pullPolicy=Never\n\nPeering with Router\n-------------------\n\nPeer Cilium nodes with FRR by applying a CiliumBGPPeeringPolicy:\n\n.. code-block:: shell-session\n\n   $ make kind-bgp-v4-apply-policy\n\n.. note::\n        At this point, there are only minimal peering settings on the policy and no advertisement configuration present. You need to edit policies, for example, with ``kubectl edit bgpp`` to realize your desired settings. If you need to change the router side, you can edit FRRouting settings with ``docker exec -it clab-bgp-cplane-dev-v4-router0 vtysh``.\n\nValidating Peering Status\n-------------------------\n\nYou can validate the peering status with the following command. Confirm that\nthe session state is established and Received and Advertised counters are zero.\n\n.. code-block:: shell-session\n\n   $ cilium bgp peers\n   Node                              Local AS   Peer AS   Peer Address   Session State   Uptime   Family         Received   Advertised\n   bgp-cplane-dev-v4-control-plane   65001      65000     10.0.1.1       established     1s       ipv4/unicast   0          0\n                                                                                                  ipv6/unicast   0          0\n   bgp-cplane-dev-v4-worker          65002      65000     10.0.2.1       established     2s       ipv4/unicast   0          0\n                                                                                                  ipv6/unicast   0          0\n\nValidating Connectivity to Cilium Nodes from Non-Cilium Node\n------------------------------------------------------------\n\nThe below example validates connectivity from server2 to server0 (10.0.1.2) and server1 (10.0.2.2). You should see the packets go through router0 (10.0.3.1).\n\n.. code-block:: shell-session\n\n   $ docker exec -it clab-bgp-cplane-dev-v4-server2 mtr 10.0.1.2 -r\n   Start: 2023-10-04T02:24:58+0000\n   HOST: server2                     Loss%   Snt   Last   Avg  Best  Wrst StDev\n     1.|-- 10.0.3.1                   0.0%    10    0.0   0.1   0.0   0.1   0.0\n     2.|-- 10.0.1.2                   0.0%    10    0.2   0.1   0.1   0.3   0.1\n\n   $ docker exec -it clab-bgp-cplane-dev-v4-server2 mtr 10.0.2.2 -r\n   Start: 2023-10-04T02:25:58+0000\n   HOST: server2                     Loss%   Snt   Last   Avg  Best  Wrst StDev\n     1.|-- 10.0.3.1                   0.0%    10    0.1   0.1   0.0   0.1   0.0\n     2.|-- 10.0.2.2                   0.0%    10    0.1   0.1   0.0   0.2   0.0\n\nDestroy Lab\n-----------\n\n.. code-block:: shell-session\n\n   $ make kind-bgp-v4-down\n",
  "item_type": "unknown",
  "module_path": "/tmp/cilium-repo/Documentation/contributing/development/bgp_cplane.rst",
  "extracted_at": "2025-09-03T00:53:44.752801Z"
}