{
  "url": "file:///tmp/cilium-repo/Documentation/contributing/development/dev_setup.rst",
  "content": ".. only:: not (epub or latex or html) \n WARNING: You are looking at unreleased Cilium documentation.\nPlease use the official rendered version released here:\nhttps://docs.cilium.io\n \n .. _dev_env: \n Development Setup \n This page provides an overview of different methods for efficient\ndevelopment on Cilium. Depending on your needs, you can choose the most\nsuitable method. \n Quick Start \n The following commands install Cilium in a  Kind -based Kubernetes cluster.\nRun them in the root directory of the Cilium repository. The  make  targets\nare described in section  Kind-based Setup <#kind-based-setup-preferred> . \n .. _Kind: https://kind.sigs.k8s.io/ \n .. note:: \n The command output informs you of any missing dependencies. In particular,\nif you get the message  'cilium' not found , it means you are missing the\nCilium CLI. \n On Linux: \n .. code-block:: shell-session \n make kind\nmake kind-image-fast\nmake kind-install-cilium-fast \n On any OS: \n .. code-block:: shell-session \n make kind\nmake kind-image\nmake kind-install-cilium \n Detailed Instructions \n Depending on your specific development environment and requirements, you\ncan follow the detailed instructions below. \n Verifying Your Development Setup \n \nAssuming you have Go installed, you can quickly verify many elements of your\ndevelopment setup by running the following command:\n\n.. code-block:: shell-session\n\n    $ make dev-doctor\n\nDepending on your end-goal, not all dependencies listed are required to develop\non Cilium. For example, \"Ginkgo\" is not required if you want to improve our\ndocumentation. Thus, do not consider that you need to have all tools installed.\n\nVersion Requirements\n~~~~~~~~~~~~~~~~~~~~\n\nIf using these tools, you need to have the following versions from them\nin order to effectively contribute to Cilium:\n\n+-------------------------------------------------------------------+------------------------------+-----------------------------------------------------------------+\n| Dependency                                                        | Version / Commit ID          | Download Command                                                |\n+===================================================================+==============================+=================================================================+\n|  git                                                              | latest                       | N/A (OS-specific)                                               |\n+-------------------------------------------------------------------+------------------------------+-----------------------------------------------------------------+\n|  clang                                                            | >= 18.1 (latest recommended) | N/A (OS-specific)                                               |\n+-------------------------------------------------------------------+------------------------------+-----------------------------------------------------------------+\n|  llvm                                                             | >= 18.1 (latest recommended) | N/A (OS-specific)                                               |\n+-------------------------------------------------------------------+------------------------------+-----------------------------------------------------------------+\n| `go <https://golang.org/dl/>`_                                    | |GO_RELEASE|                 | N/A (OS-specific)                                               |\n+-------------------------------------------------------------------+------------------------------+-----------------------------------------------------------------+\n+ `ginkgo <https://github.com/onsi/ginkgo>`__                       | >= 1.4.0 and < 2.0.0         | ``go install github.com/onsi/ginkgo/ginkgo@v1.16.5``            |\n+-------------------------------------------------------------------+------------------------------+-----------------------------------------------------------------+\n+ `golangci-lint <https://github.com/golangci/golangci-lint>`_      | >= v1.27                     | N/A (OS-specific)                                               |\n+-------------------------------------------------------------------+------------------------------+-----------------------------------------------------------------+\n+ `Docker <https://docs.docker.com/engine/installation/>`_          | OS-Dependent                 | N/A (OS-specific)                                               |\n+-------------------------------------------------------------------+------------------------------+-----------------------------------------------------------------+\n+ `Docker-Compose <https://docs.docker.com/compose/install/>`_      | OS-Dependent                 | N/A (OS-specific)                                               |\n+-------------------------------------------------------------------+------------------------------+-----------------------------------------------------------------+\n+ python3-pip                                                       | latest                       | N/A (OS-specific)                                               |\n+-------------------------------------------------------------------+------------------------------+-----------------------------------------------------------------+\n+ `helm <https://helm.sh/docs/intro/install/>`_                     | >= v3.13.0                   | N/A (OS-specific)                                               |\n+-------------------------------------------------------------------+------------------------------+-----------------------------------------------------------------+\n+ `kind <https://kind.sigs.k8s.io/docs/user/quick-start/>`__        | >= v0.7.0                    | ``go install sigs.k8s.io/kind@v0.19.0``                         |\n+-------------------------------------------------------------------+------------------------------+-----------------------------------------------------------------+\n+ `kubectl <https://kubernetes.io/docs/tasks/tools/#kubectl>`_      | >= v1.26.0                   | N/A (OS-specific)                                               |\n+-------------------------------------------------------------------+------------------------------+-----------------------------------------------------------------+\n+ `cilium-cli <https://github.com/cilium/cilium-cli#installation>`_ | Cilium-Dependent             | N/A (OS-specific)                                               |\n+-------------------------------------------------------------------+------------------------------+-----------------------------------------------------------------+\n\nFor `integration_testing`, you will need to run ``docker`` without privileges.\nYou can usually achieve this by adding your current user to the ``docker``\ngroup.\n\nKind-based Setup (preferred)\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nYou can find the setup for a `Kind`_ environment in\n``contrib/scripts/kind.sh``. This setup doesn't require any VMs and/or\nVirtualBox on Linux, but does require `Docker for Mac\n<https://docs.docker.com/desktop/install/mac-install/>`_ for Mac OS.\n\nMakefile targets automate the task of spinning up an environment:\n\n* ``make kind``: Creates a Kind cluster based on the configuration passed in.\n  For more information, see `configurations_for_clusters`.\n* ``make kind-down``: Tears down and deletes the cluster.\n\nDepending on your environment you can build Cilium by using the following\nmakefile targets:\n\nFor Linux and Mac OS\n^^^^^^^^^^^^^^^^^^^^\n\nMakefile targets automate building and installing Cilium images:\n\n* ``make kind-image``: Builds all Cilium images and loads them into the\n  cluster.\n* ``make kind-image-agent``: Builds only the Cilium Agent image and loads it\n  into the cluster.\n* ``make kind-image-operator``: Builds only the Cilium Operator (generic) image\n  and loads it into the cluster.\n* ``make kind-debug``: Builds all Cilium images with optimizations disabled and\n  ``dlv`` embedded for live debugging enabled and loads the images into the\n  cluster.\n* ``make kind-debug-agent``: Like ``kind-debug``, but for the agent image only.\n  Use if only the agent image needs to be rebuilt for faster iteration.\n* ``make kind-install-cilium``: Installs Cilium into the cluster using the\n  Cilium CLI.\n\nThe preceding list includes the most used commands for **convenience**. For more\ntargets, see the ``Makefile`` (or simply run ``make help``).\n\nFor Linux only - with shorter development workflow time\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nOn Linux environments, or on environments where you can compile and run\nCilium, it is possible to use \"fast\" targets. These fast targets will build\nCilium in the local environment and mount that binary, as well the bpf source\ncode, in an pre-existing running Cilium container.\n\n* ``make kind-install-cilium-fast``: Installs Cilium into the cluster using the\n  Cilium CLI with the volume mounts defined.\n\n* ``make kind-image-fast``: Builds all Cilium binaries and loads them into all\n  Kind clusters available in the host.\n\nConfiguration for Cilium\n^^^^^^^^^^^^^^^^^^^^^^^^\n\nThe Makefile targets that install Cilium pass the following list of Helm\nvalues (YAML files) to the Cilium CLI.\n\n* ``contrib/testing/kind-common.yaml``: Shared between normal and fast installation modes.\n* ``contrib/testing/kind-values.yaml``: Used by normal installation mode.\n* ``contrib/testing/kind-fast.yaml``: Used by fast installation mode.\n* ``contrib/testing/kind-custom.yaml``: User defined custom values that are applied if\n  the file is present. The file is ignored by Git as specified in ``contrib/testing/.gitignore``.\n\n.. _configurations_for_clusters:\n\nConfiguration for clusters\n^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n``make kind`` takes a few environment variables to modify the configuration of\nthe clusters it creates. The following parameters are the most commonly used:\n\n* ``CONTROLPLANES``: How many control-plane nodes are created.\n* ``WORKERS``: How many worker nodes are created.\n* ``CLUSTER_NAME``: The name of the Kubernetes cluster.\n* ``IMAGE``: The image for Kind, for example: ``kindest/node:v1.11.10``.\n* ``KUBEPROXY_MODE``: Pass directly as ``kubeProxyMode`` to the Kind\n  configuration Custom Resource Definition (CRD).\n\nFor more environment variables, see ``contrib/scripts/kind.sh``.\n\n.. _making_changes:\n\nMaking Changes\n--------------\n\n#. Make sure the ``main`` branch of your fork is up-to-date:\n\n   .. code-block:: shell-session\n\n      git fetch upstream main:main\n\n#. Create a PR branch with a descriptive name, branching from ``main``:\n\n   .. code-block:: shell-session\n\n      git switch -c pr/changes-to-something main\n\n#. Make the changes you want.\n#. Separate the changes into logical commits.\n\n   #. Describe the changes in the commit messages. Focus on answering the\n      question why the change is required and document anything that might be\n      unexpected.\n   #. If any description is required to understand your code changes, then\n      those instructions should be code comments instead of statements in the\n      commit description.\n\n   .. note::\n\n      For submitting PRs, all commits need be to signed off (``git commit -s``). See the section :ref:`dev_coo`.\n\n#. Make sure your changes meet the following criteria:\n\n   #. New code is covered by :ref:`integration_testing`.\n   #. End to end integration / runtime tests have been extended or added. If\n      not required, mention in the commit message what existing test covers the\n      new code.\n   #. Follow-up commits are squashed together nicely. Commits should separate\n      logical chunks of code and not represent a chronological list of changes.\n\n#. Run ``git diff --check`` to catch obvious white space violations\n#. Run ``make`` to build your changes. This will also run ``make lint`` and error out\n   on any golang linting errors. The rules are configured in ``.golangci.yaml``\n#. Run ``make -C bpf checkpatch`` to validate against your changes\n   coding style and commit messages.\n#. See :ref:`integration_testing` on how to run integration tests.\n#. See :ref:`testsuite` for information how to run the end to end integration\n   tests\n#. If you are making documentation changes, you can generate documentation files\n   and serve them locally on ``http://localhost:9081`` by running ``make render-docs``.\n   This make target works assuming that ``docker`` is running in the environment.\n\nDev Container\n-------------\n\nCilium provides `Dev Container <https://code.visualstudio.com/docs/devcontainers/containers>`_ configuration for Visual Studio Code Remote Containers\nand `Github Codespaces <https://docs.github.com/en/codespaces/setting-up-your-project-for-codespaces/introduction-to-dev-containers>`_.\nThis allows you to use a preconfigured development environment in the cloud or locally.\nThe container is based on the official Cilium builder image and provides all the dependencies\nrequired to build Cilium.\n\nYou can also install common packages, such as ``kind``, ``kubectl``, and\n``cilium-cli``, with ``contrib/scripts/devcontainer-setup.sh``:\n\n.. code-block:: shell-session\n\n    $ ./contrib/scripts/devcontainer-setup.sh\n\nPackage versions can be modified to fit your requirements.\nThis needs to only be set up once when the ``devcontainer`` is first created.\n\n.. note::\n\n    The current Dev Container is running as root. Non-root user support requires non-root\n    user in Cilium builder image, which is related to :gh-issue:`23217`.\n\nUpdate a golang version\n-----------------------\n\nMinor version\n~~~~~~~~~~~~~\n\nEach Cilium release is tied to a specific version of Golang via an explicit constraint\nin our Renovate configuration.\n\nWe aim to build and release all maintained Cilium branches using a Golang version\nthat is actively supported. This needs to be balanced against the desire to avoid\nregressions in Golang that may impact Cilium. Golang supports two minor versions\nat any given time – when updating the version used by a Cilium branch, you should\nchoose the older of the two supported versions.\n\nTo update the minor version of Golang used by a release, you will first need to\nupdate the Renovate configuration found in ``.github/renovate.json5``. For each\nminor release, there will be a section that looks like this:\n\n.. code-block:: json\n\n    {\n      \"matchPackageNames\": [\n        \"docker.io/library/golang\",\n        \"go\"\n      ],\n      \"allowedVersions\": \"<1.21\",\n      \"matchBaseBranches\": [\n        \"v1.14\"\n      ]\n    }\n\nTo allow Renovate to create a pull request that updates the minor Golang version,\nbump the ``allowedVersions`` constraint to include the desired minor version. Once\nthis change has been merged, Renovate will create a pull request that updates the\nGolang version. Minor version updates may require further changes to ensure that\nall Cilium features are working correctly – use the CI to identify any issues that\nrequire further changes, and bring them to the attention of the Cilium maintainers\nin the pull request.\n\nOnce the CI is passing, the PR will be merged as part of the standard version\nupgrade process.\n\nPatch version\n~~~~~~~~~~~~~\n\nNew patch versions of Golang are picked up automatically by the CI; there should\nnormally be no need to update the version manually.\n\nAdd/update a golang dependency\n------------------------------\n\nLet's assume we want to add ``github.com/containernetworking/cni`` version ``v0.5.2``:\n\n.. code-block:: shell-session\n\n    $ go get github.com/containernetworking/cni@v0.5.2\n    $ go mod tidy\n    $ go mod vendor\n    $ git add go.mod go.sum vendor/\n\nFor a first run, it can take a while as it will download all dependencies to\nyour local cache but the remaining runs will be faster.\n\nUpdating k8s is a special case which requires updating k8s libraries in a single\nchange:\n\n.. code-block:: shell-session\n\n    $ # get the tag we are updating (for example ``v0.17.3`` corresponds to k8s ``v1.17.3``)\n    $ # open go.mod and search and replace all ``v0.17.3`` with the version\n    $ # that we are trying to upgrade with, for example: ``v0.17.4``.\n    $ # Close the file and run:\n    $ go mod tidy\n    $ go mod vendor\n    $ make generate-k8s-api\n    $ git add go.mod go.sum vendor/\n\nAdd/update a cilium/kindest-node image\n--------------------------------------\n\nCilium might use its own fork of kindest-node so that it can use k8s versions\nthat have not been released by Kind maintainers yet.\n\nOne other reason for using a fork is that the base image used on kindest-node\nmay not have been release yet. For example, as of this writing, Cilium requires\nDebian Bookworm (yet to be released), because the glibc version available on\nCilium's base Docker image is the same as the one used in the Bookworm Docker\nimage which is relevant for testing with Go's race detector.\n\nCurrently, only maintainers can publish an image on ``quay.io/cilium/kindest-node``.\nHowever, anyone can build a kindest-node image and try it out\n\nTo build a cilium/kindest-node image, first build the base Docker image:\n\n   .. code-block:: shell-session\n\n    git clone https://github.com/kubernetes-sigs/kind.git\n    cd kind\n    make -C images/base/ quick\n\nTake note of the resulting image tag for that command, it should be the last\ntag built for the ``gcr.io/k8s-staging-kind/base`` repository in ``docker ps -a``.\n\nSecondly, change into the directory with Kubernetes' source code which will be\nused for the kindest node image. On this example, we will build a kindest-base\nimage with Kubernetes version ``v1.28.3`` using the recently-built base image\n``gcr.io/k8s-staging-kind/base:v20231108-a9fbf702``:\n\n   .. code-block:: shell-session\n\n    $ # Change to k8s' source code directory.\n    $ git clone https://github.com/kubernetes/kubernetes.git\n    $ cd kubernetes\n    $ tag=v1.28.3\n    $ git fetch origin --tags\n    $ git checkout tags/${tag}\n    $ kind build node-image \\\n      --image=quay.io/cilium/kindest-node:${tag} \\\n      --base-image=gcr.io/k8s-staging-kind/base:v20231108-a9fbf702\n\nFinally, publish the image to a public repository. If you are a maintainer and\nhave permissions to publish on ``quay.io/cilium/kindest-node``, the Renovate bot\nwill automatically pick the new version and create a new Pull Request with this\nupdate. If you are not a maintainer you will have to update the image manually\nin Cilium's repository.\n\nAdd/update a new Kubernetes version\n-----------------------------------\n\nLet's assume we want to add a new Kubernetes version ``v1.19.0``:\n\n#. Follow the above instructions to update the Kubernetes libraries.\n\n#. Follow the next instructions depending on if it is a minor update or a patch\n   update.\n\nMinor version\n~~~~~~~~~~~~~\n\n#. Check if it is possible to remove the last supported Kubernetes version from\n   :ref:`k8scompatibility`, :ref:`k8s_requirements` and add the new Kubernetes\n   version to that list.\n\n#. If the minimal supported version changed, leave a note in the upgrade guide\n   stating the minimal supported Kubernetes version.\n\n#. If the minimal supported version changed, search over the code, more likely\n   under ``pkg/k8s``, if there is code that can be removed which specifically\n   exists for the compatibility of the previous Kubernetes minimal version\n   supported.\n\n#. If the minimal supported version changed, update the field\n   ``MinimalVersionConstraint`` in ``pkg/k8s/version/version.go``\n\n#. Sync all \"``slim``\" types by following the instructions in\n   ``pkg/k8s/slim/README.md``.  The overall goal is to update changed fields or\n   deprecated fields from the upstream code. New functions / fields / structs\n   added in upstream that are not used in Cilium, can be removed.\n\n#. Make sure the workflows used on all PRs are running with the new Kubernetes\n   version by default. Make sure the files ``contributing/testing/{ci,e2e}.rst``\n   are up to date with these changes.\n\n#. Update documentation files:\n   - ``Documentation/contributing/testing/e2e.rst``\n   - ``Documentation/network/kubernetes/compatibility.rst``\n   - ``Documentation/network/kubernetes/requirements.rst``\n\n#. Update the Kubernetes version with the newer version in\n   - ``test/test_suite_test.go``.\n   - ``.github/actions/ginkgo/main-prs.yaml``\n   - ``.github/actions/ginkgo/main-scheduled.yaml``\n   - ``.github/actions/set-env-variables/action.yml``\n   - ``contrib/scripts/devcontainer-setup.sh``\n   - ``.github/actions/ginkgo/main-focus.yaml``\n\n#. Bump the kindest/node version in\n   ``.github/actions/ginkgo/main-k8s-versions.yaml``.\n\n#. Run ``./contrib/scripts/check-k8s-code-gen.sh``\n\n#. Check ``controller-runtime`` compatibility with the new Kubernetes version. If\n   there are any changes required, update the controller-runtime version in\n   ``go.mod``. See https://github.com/kubernetes-sigs/controller-runtime?tab=readme-ov-file#compatibility.\n\n#. Run ``go mod vendor && go mod tidy``\n\n#. Run ``./contrib/scripts/check-k8s-code-gen.sh`` (again)\n\n#. Run ``make -C Documentation update-helm-values``\n\n#. Compile the code locally to make sure all the library updates didn't removed\n   any used code.\n\n#. Provision a new dev VM to check if the provisioning scripts work correctly\n   with the new k8s version.\n\n#. Run ``git add vendor/ test/provision/manifest/ Documentation/ && git commit -sam \"Update k8s tests and libraries to v1.28.0-rc.0\"``\n\n#. Submit all your changes into a new PR. Ensure the PR is opened against a\n   branch in ``cilium/cilium`` and *not* a fork. Otherwise, CI is not triggered\n   properly. Please open a thread on #development if you do not have\n   permissions to create a branch in ``cilium/cilium``.\n\n#. Ensure that the target CI workflows are running and passing after updating\n   the target k8s versions in the GitHub action workflows.\n\n#. Once CI is green and PR has been merged, ping the CI team again so that they\n   update the `Cilium CI matrix`_, ``.github/maintainers-little-helper.yaml``,\n   and GitHub required PR checks accordingly.\n\n.. _Cilium CI matrix: https://docs.google.com/spreadsheets/d/1TThkqvVZxaqLR-Ela4ZrcJ0lrTJByCqrbdCjnI32_X0\n\nPatch version\n~~~~~~~~~~~~~\n\n#. Submit all your changes into a new PR.\n\nMaking changes to the Helm chart\n--------------------------------\n\nThe Helm chart is located in the ``install/kubernetes`` directory. The\n``values.yaml.tmpl`` file contains the values for the Helm chart which are being used into the ``values.yaml`` file.\n\nTo prepare your changes you need to run the make scripts for the chart:\n\n.. code-block:: shell-session\n\n   $ make -C install/kubernetes\n\nThis does all needed steps in one command. Your change to the Helm chart is now ready to be submitted!\n\nYou can also run them one by one using the individual targets below.\n\nWhen updating or adding a value they can be synced to the ``values.yaml`` file by running the following command:\n\n.. code-block:: shell-session\n\n   $ make -C install/kubernetes cilium/values.yaml\n\nBefore submitting the changes the ``README.md`` file needs to be updated, this can be done using the ``docs`` target:\n\n.. code-block:: shell-session\n\n   $ make -C install/kubernetes docs\n\nAt last you might want to check the chart using the ``lint`` target:\n\n.. code-block:: shell-session\n\n   $ make -C install/kubernetes lint\n\n\nOptional: Docker and IPv6\n-------------------------\n\nNote that these instructions are useful to you if you care about having IPv6\naddresses for your Docker containers.\n\nIf you'd like IPv6 addresses, you will need to follow these steps:\n\n1) Edit ``/etc/docker/daemon.json`` and set the ``ipv6`` key to ``true``.\n\n   .. code-block:: json\n\n      {\n        \"ipv6\": true\n      }\n\n\n   If that doesn't work alone, try assigning a fixed range. Many people have\n   reported trouble with IPv6 and Docker. `Source here.\n   <https://github.com/moby/moby/issues/29443#issuecomment-495808871>`_\n\n   .. code-block:: json\n\n      {\n        \"ipv6\": true,\n        \"fixed-cidr-v6\": \"2001:db8:1::/64\"\n      }\n\n\n   And then:\n\n   .. code-block:: shell-session\n\n    ip -6 route add 2001:db8:1::/64 dev docker0\n    sysctl net.ipv6.conf.default.forwarding=1\n    sysctl net.ipv6.conf.all.forwarding=1\n\n\n2) Restart the docker daemon to pick up the new configuration.\n\n3) The new command for creating a network managed by Cilium:\n\n   .. code-block:: shell-session\n\n      $ docker network create --ipv6 --driver cilium --ipam-driver cilium cilium-net\n\n\nNow new containers will have an IPv6 address assigned to them.\n\nDebugging\n---------\n\nDatapath code\n~~~~~~~~~~~~~\n\nThe tool ``cilium-dbg monitor`` can also be used to retrieve debugging information\nfrom the eBPF based datapath. To enable all log messages:\n\n- Start the ``cilium-agent`` with ``--debug-verbose=datapath``, or\n- Run ``cilium-dbg config debug=true debugLB=true`` from an already running agent.\n\nThese options enable logging functions in the datapath: ``cilium_dbg()``,\n``cilium_dbg_lb()`` and ``printk()``.\n\n.. note::\n\n   The ``printk()`` logging function is used by the developer to debug the datapath outside of the ``cilium\n   monitor``.  In this case, ``bpftool prog tracelog`` can be used to retrieve\n   debugging information from the eBPF based datapath. Both ``cilium_dbg()`` and\n   ``printk()`` functions are available from the ``bpf/lib/dbg.h`` header file.\n\nThe image below shows the options that could be used as startup options by\n``cilium-agent`` (see upper blue box) or could be changed at runtime by running\n``cilium-dbg config <option(s)>`` for an already running agent (see lower blue box).\nAlong with each option, there is one or more logging function associated with it:\n``cilium_dbg()`` and ``printk()``, for ``DEBUG`` and ``cilium_dbg_lb()`` for\n``DEBUG_LB``.\n\n.. image:: _static/cilium-debug-datapath-options.svg\n  :align: center\n  :alt: Cilium debug datapath options\n\n.. note::\n\n   If you need to enable the ``LB_DEBUG`` for an already running agent by running\n   ``cilium-dbg config debugLB=true``, you must pass the option ``debug=true`` along.\n\nDebugging of an individual endpoint can be enabled by running\n``cilium-dbg endpoint config ID debug=true``. Running ``cilium-dbg monitor -v`` will\nprint the normal form of monitor output along with debug messages:\n\n.. code-block:: shell-session\n\n   $ cilium-dbg endpoint config 731 debug=true\n   Endpoint 731 configuration updated successfully\n   $ cilium-dbg monitor -v\n   Press Ctrl-C to quit\n   level=info msg=\"Initializing dissection cache...\" subsys=monitor\n   <- endpoint 745 flow 0x6851276 identity 4->0 state new ifindex 0 orig-ip 0.0.0.0: 8e:3c:a3:67:cc:1e -> 16:f9:cd:dc:87:e5 ARP\n   -> lxc_health: 16:f9:cd:dc:87:e5 -> 8e:3c:a3:67:cc:1e ARP\n   CPU 00: MARK 0xbbe3d555 FROM 0 DEBUG: Inheriting identity=1 from stack\n   <- host flow 0xbbe3d555 identity 1->0 state new ifindex 0 orig-ip 0.0.0.0: 10.11.251.76:57896 -> 10.11.166.21:4240 tcp ACK\n   CPU 00: MARK 0xbbe3d555 FROM 0 DEBUG: Successfully mapped addr=10.11.251.76 to identity=1\n   CPU 00: MARK 0xbbe3d555 FROM 0 DEBUG: Attempting local delivery for container id 745 from seclabel 1\n   CPU 00: MARK 0xbbe3d555 FROM 745 DEBUG: Conntrack lookup 1/2: src=10.11.251.76:57896 dst=10.11.166.21:4240\n   CPU 00: MARK 0xbbe3d555 FROM 745 DEBUG: Conntrack lookup 2/2: nexthdr=6 flags=0\n   CPU 00: MARK 0xbbe3d555 FROM 745 DEBUG: CT entry found lifetime=21925, revnat=0\n   CPU 00: MARK 0xbbe3d555 FROM 745 DEBUG: CT verdict: Established, revnat=0\n   -> endpoint 745 flow 0xbbe3d555 identity 1->4 state established ifindex lxc_health orig-ip 10.11.251.76: 10.11.251.76:57896 -> 10.11.166.21:4240 tcp ACK\n\nPassing ``-v -v`` supports deeper detail, for example:\n\n.. code-block:: shell-session\n\n    $ cilium-dbg endpoint config 3978 debug=true\n    Endpoint 3978 configuration updated successfully\n    $ cilium-dbg monitor -v -v --hex\n    Listening for events on 2 CPUs with 64x4096 of shared memory\n    Press Ctrl-C to quit\n    ------------------------------------------------------------------------------\n    CPU 00: MARK 0x1c56d86c FROM 3978 DEBUG: 70 bytes Incoming packet from container ifindex 85\n    00000000  33 33 00 00 00 02 ae 45  75 73 11 04 86 dd 60 00  |33.....Eus....`.|\n    00000010  00 00 00 10 3a ff fe 80  00 00 00 00 00 00 ac 45  |....:..........E|\n    00000020  75 ff fe 73 11 04 ff 02  00 00 00 00 00 00 00 00  |u..s............|\n    00000030  00 00 00 00 00 02 85 00  15 b4 00 00 00 00 01 01  |................|\n    00000040  ae 45 75 73 11 04 00 00  00 00 00 00              |.Eus........|\n    CPU 00: MARK 0x1c56d86c FROM 3978 DEBUG: Handling ICMPv6 type=133\n    ------------------------------------------------------------------------------\n    CPU 00: MARK 0x1c56d86c FROM 3978 Packet dropped 131 (Invalid destination mac) 70 bytes ifindex=0 284->0\n    00000000  33 33 00 00 00 02 ae 45  75 73 11 04 86 dd 60 00  |33.....Eus....`.|\n    00000010  00 00 00 10 3a ff fe 80  00 00 00 00 00 00 ac 45  |....:..........E|\n    00000020  75 ff fe 73 11 04 ff 02  00 00 00 00 00 00 00 00  |u..s............|\n    00000030  00 00 00 00 00 02 85 00  15 b4 00 00 00 00 01 01  |................|\n    00000040  00 00 00 00                                       |....|\n    ------------------------------------------------------------------------------\n    CPU 00: MARK 0x7dc2b704 FROM 3978 DEBUG: 86 bytes Incoming packet from container ifindex 85\n    00000000  33 33 ff 00 8a d6 ae 45  75 73 11 04 86 dd 60 00  |33.....Eus....`.|\n    00000010  00 00 00 20 3a ff fe 80  00 00 00 00 00 00 ac 45  |... :..........E|\n    00000020  75 ff fe 73 11 04 ff 02  00 00 00 00 00 00 00 00  |u..s............|\n    00000030  00 01 ff 00 8a d6 87 00  20 40 00 00 00 00 fd 02  |........ @......|\n    00000040  00 00 00 00 00 00 c0 a8  21 0b 00 00 8a d6 01 01  |........!.......|\n    00000050  ae 45 75 73 11 04 00 00  00 00 00 00              |.Eus........|\n    CPU 00: MARK 0x7dc2b704 FROM 3978 DEBUG: Handling ICMPv6 type=135\n    CPU 00: MARK 0x7dc2b704 FROM 3978 DEBUG: ICMPv6 neighbour soliciation for address b21a8c0:d68a0000\n\n\nOne of the most common issues when developing datapath code is that the eBPF\ncode cannot be loaded into the kernel. This frequently manifests as the\nendpoints appearing in the \"not-ready\" state and never switching out of it:\n\n.. code-block:: shell-session\n\n    $ cilium-dbg endpoint list\n    ENDPOINT   POLICY        IDENTITY   LABELS (source:key[=value])   IPv6                     IPv4            STATUS\n               ENFORCEMENT\n    48896      Disabled      266        container:id.server           fd02::c0a8:210b:0:bf00   10.11.13.37     not-ready\n    60670      Disabled      267        container:id.client           fd02::c0a8:210b:0:ecfe   10.11.167.158   not-ready\n\nRunning ``cilium-dbg endpoint get`` for one of the endpoints will provide a\ndescription of known state about it, which includes eBPF verification logs.\n\nThe files under ``/var/run/cilium/state`` provide context about how the eBPF\ndatapath is managed and set up. The .h files describe specific configurations\nused for eBPF program compilation. The numbered directories describe\nendpoint-specific state, including header configuration files and eBPF binaries.\n\nCurrent eBPF map state for particular programs is held under ``/sys/fs/bpf/``,\nand the `bpf-map <https://github.com/cilium/bpf-map>`_ utility can be useful\nfor debugging what is going on inside them, for example:\n\n.. code-block:: shell-session\n\n    # ls /sys/fs/bpf/tc/globals/\n    cilium_calls_15124  cilium_calls_48896        cilium_ct4_global       cilium_lb4_rr_seq       cilium_lb6_services  cilium_policy_v2_25729     cilium_policy_v2_60670       cilium_tunnel_map\n    cilium_calls_25729  cilium_calls_60670        cilium_ct6_global       cilium_lb4_services     cilium_lxc           cilium_policy_v2_3978      cilium_policy_v2_reserved_1\n    cilium_calls_3978   cilium_calls_netdev_ns_1  cilium_events           cilium_lb6_reverse_nat  cilium_policy        cilium_policy_v2_4314      cilium_policy_v2_reserved_2\n    cilium_calls_4314   cilium_calls_overlay_2    cilium_lb4_reverse_nat  cilium_lb6_rr_seq       cilium_policy_v2_15124  cilium_policy_v2_48896  cilium_reserved_policy\n    # bpf-map info /sys/fs/bpf/tc/globals/cilium_policy_v2_15124\n    Type:           Hash\n    Key size:       8\n    Value size:     24\n    Max entries:    1024\n    Flags:          0x0\n    # bpf-map dump /sys/fs/bpf/tc/globals/cilium_policy_v2_15124\n    Key:\n    00000000  6a 01 00 00 82 23 06 00                           |j....#..|\n    Value:\n    00000000  01 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\n    00000010  00 00 00 00 00 00 00 00                           |........|",
  "item_type": "unknown",
  "module_path": "/tmp/cilium-repo/Documentation/contributing/development/dev_setup.rst",
  "extracted_at": "2025-09-03T00:53:44.761321Z"
}