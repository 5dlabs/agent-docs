{
  "url": "file:///tmp/cilium-repo/Documentation/network/clustermesh/gke-clustermesh-prep.rst",
  "content": ".. _gs_clustermesh_gke_prep: \n \n GKE-to-GKE Clustermesh Preparation \n \n This is a step-by-step guide on how to install and prepare\nGoogle Kubernetes Engine (GKE) clusters to meet the requirements\nfor the clustermesh feature. \n This guide describes how to deploy two zonal, single node GKE clusters\nin different regions for the express purpose of creating a\ncost-effective environment to deploy a clustermesh to. Ideal for\ndevelopment/learning purposes. \n .. note:: \n     The steps below require the `gcloud <https://cloud.google.com/sdk/docs/install>`__ CLI tool\n \n Create VPC\n########## \n \n \n Create a VPC network in your GCP project. Environment variables are recommended as their\nvalues will be referenced in later steps. \n .. code-block:: bash \n #  feel free to choose your own VPC network name\nexport PROJECT_ID=\"[GCP_PROJECT_ID]\"\nexport VPC_NETWORK=\"my-gke-network\"\n\ngcloud compute networks create ${VPC_NETWORK} \\\n  --subnet-mode=auto \\\n  --project ${PROJECT_ID}\n\ngcloud compute firewall-rules create ${VPC_NETWORK}-allow-internal \\\n  --network ${VPC_NETWORK} \\\n  --allow tcp,udp,icmp \\\n  --source-ranges \"10.128.0.0/9\"\n \n \n \n Deploy clusters\n############### \n \n \n Set additional environment variables for values that will be reused in\nlater steps. \n .. code-block:: bash \n #  us-west1-a can be changed to any available location (`gcloud compute zones list`)\nexport CLUSTER=\"gke-1\"\nexport ZONE=\"us-west1-a\"\nexport POD_CIDR=\"10.0.0.0/18\"\nexport SERVICES_CIDR=\"10.1.0.0/20\"\n \n Below is an example to deploy one GKE cluster. To create more clusters, follow the\nsteps again, using distinct cluster names, zones, pod CIDRs, and services CIDRs. \n .. note:: \n You can use different pod and services CIDRs than in the example, but make sure \nthey meet the IP address range `rules <https://cloud.google.com/kubernetes-engine/docs/concepts/alias-ips#cluster_sizing>`__. But most\nimportantly, make sure they do not overlap with the pods and services CIDRs in\nyour other cluster(s).\n \n .. code-block:: bash \n gcloud container clusters create ${CLUSTER} \\\n  --zone ${ZONE} \\\n  --node-locations ${ZONE} \\\n  --network=${VPC_NETWORK} \\\n  --enable-ip-alias \\\n  --cluster-ipv4-cidr=${POD_CIDR} \\\n  --services-ipv4-cidr=${SERVICES_CIDR} \\\n  --machine-type=e2-medium \\\n  --max-nodes=1 \\\n  --num-nodes=1 \\\n  --node-taints node.cilium.io/agent-not-ready=true:NoSchedule \\\n  --project ${PROJECT_ID}\n\n# Get kubectl credentials, the command will merge the new credentials\n# with the existing ~/.kube/config\ngcloud container clusters get-credentials ${CLUSTER} \\\n  --zone ${ZONE} \\\n  --project ${PROJECT_ID}\n \n The node taint is used to prevent pods from being deployed/started until Cilium\nhas been installed. \n \n \n Install Cilium. \n .. important:: \n Be sure to assign a unique ``cluster.id`` to each cluster.\n \n .. code-block:: bash \n cilium install \\\n    --version |CHART_VERSION| \\\n    --set cluster.id=1 \\\n    --set cluster.name=${CLUSTER}\n \n \n \n Check the status of Cilium. \n .. code-block:: bash \n cilium status   \n \n \n \n For each GKE cluster, save its context in an environment variable for use in\nthe clustermesh setup process. \n GKE cluster context is a combination of project ID, location, and cluster name. \n .. code-block:: bash \n export CONTEXT1=\"gke_${PROJECT_ID}_${ZONE}_${CLUSTER}\"\n \n \n \n Peering VPC networks\n######################## \n Google Cloud's VPCs are global in scope, so subnets within the same VPC can already communicate\nwith each other internally -- regardless of region. So there is no VPC peering required! \n Node-to-node traffic between clusters is now possible. All requirements for\nclustermesh are met. Enabling clustermesh is explained in :ref: gs_clustermesh . \n Please reference environment variables exported in step 4 for any commands that require\nthe Kubernetes context.",
  "item_type": "unknown",
  "module_path": "/tmp/cilium-repo/Documentation/network/clustermesh/gke-clustermesh-prep.rst",
  "extracted_at": "2025-09-03T01:13:29.193147Z"
}