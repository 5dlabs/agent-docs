{
  "url": "file:///tmp/cilium-repo/Documentation/observability/hubble/setup.rst",
  "content": ".. only:: not (epub or latex or html)\n\n    WARNING: You are looking at unreleased Cilium documentation.\n    Please use the official rendered version released here:\n    https://docs.cilium.io\n\n.. _hubble_setup:\n\n*******************************\nSetting up Hubble Observability\n*******************************\n\nHubble is the observability layer of Cilium and can be used to obtain\ncluster-wide visibility into the network and security layer of your Kubernetes\ncluster.\n\n.. note::\n\n   This guide assumes that Cilium has been correctly installed in your\n   Kubernetes cluster. Please see :ref:`k8s_quick_install` for more\n   information. If unsure, run ``cilium status`` and validate that Cilium is up\n   and running.\n\nEnable Hubble in Cilium\n=======================\n\n.. tip::\n\n    Enabling Hubble requires the TCP port 4244 to be open on all nodes running\n    Cilium. This is required for Relay to operate correctly.\n\n.. tabs::\n\n    .. group-tab:: Cilium CLI\n\n        In order to enable Hubble and install Hubble relay, run the\n        command ``cilium hubble enable`` as shown below:\n\n        .. code-block:: shell-session\n\n            $ cilium hubble enable\n            üîë Found existing CA in secret cilium-ca\n            ‚ú® Patching ConfigMap cilium-config to enable Hubble...\n            ‚ôªÔ∏è  Restarted Cilium pods\n            üîë Generating certificates for Relay...\n            2021/04/13 17:11:23 [INFO] generate received request\n            2021/04/13 17:11:23 [INFO] received CSR\n            2021/04/13 17:11:23 [INFO] generating key: ecdsa-256\n            2021/04/13 17:11:23 [INFO] encoded CSR\n            2021/04/13 17:11:23 [INFO] signed certificate with serial number 365589302067830033295858933512588007090526050046\n            2021/04/13 17:11:24 [INFO] generate received request\n            2021/04/13 17:11:24 [INFO] received CSR\n            2021/04/13 17:11:24 [INFO] generating key: ecdsa-256\n            2021/04/13 17:11:24 [INFO] encoded CSR\n            2021/04/13 17:11:24 [INFO] signed certificate with serial number 644167683731852948186644541769558498727586273511\n            ‚ú® Deploying Relay...\n\n    .. group-tab:: Helm\n\n        If you installed Cilium via ``helm install``, Hubble is enabled by default.\n        You may enable Hubble Relay with the following command:\n\n        .. parsed-literal::\n\n           helm upgrade cilium |CHART_RELEASE| \\\\\n              --namespace kube-system \\\\\n              --reuse-values \\\\\n              --set hubble.relay.enabled=true\n\nRun ``cilium status`` to validate that Hubble is enabled and running:\n\n.. code-block:: shell-session\n\n    $ cilium status\n        /¬Ø¬Ø\\\n     /¬Ø¬Ø\\__/¬Ø¬Ø\\    Cilium:             OK\n     \\__/¬Ø¬Ø\\__/    Operator:           OK\n     /¬Ø¬Ø\\__/¬Ø¬Ø\\    Envoy DaemonSet:    OK\n     \\__/¬Ø¬Ø\\__/    Hubble Relay:       OK\n        \\__/       ClusterMesh:        disabled\n\n    DaemonSet             cilium                   Desired: 1, Ready: 1/1, Available: 1/1\n    DaemonSet             cilium-envoy             Desired: 1, Ready: 1/1, Available: 1/1\n    Deployment            cilium-operator          Desired: 1, Ready: 1/1, Available: 1/1\n    Deployment            hubble-relay             Desired: 1, Ready: 1/1, Available: 1/1\n    Containers:           cilium                   Running: 1\n                          cilium-envoy             Running: 1\n                          cilium-operator          Running: 1\n                          clustermesh-apiserver\n                          hubble-relay             Running: 1\n    Cluster Pods:         8/8 managed by Cilium\n    Helm chart version:   1.17.0\n    Image versions        cilium             quay.io/cilium/cilium:latest: 1\n                          cilium-envoy       quay.io/cilium/cilium-envoy:v1.32.3-1739240299-e85e926b0fa4cec519cefff54b60bd7942d7871b@sha256:ced8a89d642d10d648471afc2d8737238f1479c368955e6f2553ded58029ac88: 1\n                          cilium-operator    quay.io/cilium/operator-generic-ci:latest: 1\n                          hubble-relay       quay.io/cilium/hubble-relay-ci:latest: 1\n\n.. _hubble_cli_install:\n\nInstall the Hubble Client\n=========================\n\nIn order to access the observability data collected by Hubble, you must first install Hubble CLI.\n\nSelect the tab for your platform below and install the latest release of Hubble CLI.\n\n.. tabs::\n\n   .. group-tab:: Linux\n\n      Download the latest hubble release:\n\n      .. code-block:: shell-session\n\n         HUBBLE_VERSION=$(curl -s https://raw.githubusercontent.com/cilium/hubble/master/stable.txt)\n         HUBBLE_ARCH=amd64\n         if [ \"$(uname -m)\" = \"aarch64\" ]; then HUBBLE_ARCH=arm64; fi\n         curl -L --fail --remote-name-all https://github.com/cilium/hubble/releases/download/$HUBBLE_VERSION/hubble-linux-${HUBBLE_ARCH}.tar.gz{,.sha256sum}\n         sha256sum --check hubble-linux-${HUBBLE_ARCH}.tar.gz.sha256sum\n         sudo tar xzvfC hubble-linux-${HUBBLE_ARCH}.tar.gz /usr/local/bin\n         rm hubble-linux-${HUBBLE_ARCH}.tar.gz{,.sha256sum}\n\n   .. group-tab:: MacOS\n\n      Download the latest hubble release:\n\n      .. code-block:: shell-session\n\n         HUBBLE_VERSION=$(curl -s https://raw.githubusercontent.com/cilium/hubble/master/stable.txt)\n         HUBBLE_ARCH=amd64\n         if [ \"$(uname -m)\" = \"arm64\" ]; then HUBBLE_ARCH=arm64; fi\n         curl -L --fail --remote-name-all https://github.com/cilium/hubble/releases/download/$HUBBLE_VERSION/hubble-darwin-${HUBBLE_ARCH}.tar.gz{,.sha256sum}\n         shasum -a 256 -c hubble-darwin-${HUBBLE_ARCH}.tar.gz.sha256sum\n         sudo tar xzvfC hubble-darwin-${HUBBLE_ARCH}.tar.gz /usr/local/bin\n         rm hubble-darwin-${HUBBLE_ARCH}.tar.gz{,.sha256sum}\n\n   .. group-tab:: Windows\n\n      Download the latest hubble release:\n\n      .. code-block:: shell-session\n\n         curl -LO \"https://raw.githubusercontent.com/cilium/hubble/master/stable.txt\"\n         set /p HUBBLE_VERSION=<stable.txt\n         curl -L --fail -O \"https://github.com/cilium/hubble/releases/download/%HUBBLE_VERSION%/hubble-windows-amd64.tar.gz\"\n         curl -L --fail -O \"https://github.com/cilium/hubble/releases/download/%HUBBLE_VERSION%/hubble-windows-amd64.tar.gz.sha256sum\"\n         certutil -hashfile hubble-windows-amd64.tar.gz SHA256\n         type hubble-windows-amd64.tar.gz.sha256sum\n         :: verify that the checksum from the two commands above match\n         tar zxf hubble-windows-amd64.tar.gz\n\n      and move the ``hubble.exe`` CLI to a directory listed in the ``%PATH%`` environment variable after\n      extracting it from the tarball.\n\n.. _hubble_validate_api_access:\n\nValidate Hubble API Access\n==========================\n\n.. include:: port-forward.rst\n\nNow you can validate that you can access the Hubble API via the installed CLI:\n\n.. code-block:: shell-session\n\n    $ hubble status -P\n    Healthcheck (via 127.0.0.1:4245): Ok\n    Current/Max Flows: 11917/12288 (96.98%)\n    Flows/s: 11.74\n    Connected Nodes: 3/3\n\nYou can also query the flow API and look for flows:\n\n.. code-block:: shell-session\n\n   $ hubble observe -P\n   Feb 12 19:13:58.111: kube-system/hubble-relay-6467f4f4d-xrxfs:47550 (ID:95552) -> 172.18.0.2:4244 (host) to-stack FORWARDED (TCP Flags: ACK, PSH)\n   ...\n\n.. note::\n\n   If you port forward to a port other than ``4245`` (``--port-forward-port PORT``\n   when using automatic port-forwarding), make sure to use the ``--server`` flag\n   or ``HUBBLE_SERVER`` environment variable to set the Hubble server address\n   (default: ``localhost:4245``).\n\n   For more information, check out Hubble CLI's help message by running ``hubble help status``\n   or ``hubble help observe`` as well as ``hubble config`` for  configuring Hubble CLI.\n\n.. note::\n\n   If you have :ref:`enabled TLS<hubble_enable_tls>` then you will need to specify additional flags to :ref:`access the Hubble API<hubble_api_tls>`.\n\nTroubleshooting Hubble Deployment\n=================================\n\nValidate the state of Hubble and/or Hubble Relay by running ``cilium status``:\n\n.. code-block:: shell-session\n\n    $ cilium status\n        /¬Ø¬Ø\\\n     /¬Ø¬Ø\\__/¬Ø¬Ø\\    Cilium:             OK\n     \\__/¬Ø¬Ø\\__/    Operator:           OK\n     /¬Ø¬Ø\\__/¬Ø¬Ø\\    Envoy DaemonSet:    OK\n     \\__/¬Ø¬Ø\\__/    Hubble Relay:       OK\n        \\__/       ClusterMesh:        disabled\n\n    DaemonSet             cilium                   Desired: 1, Ready: 1/1, Available: 1/1\n    DaemonSet             cilium-envoy             Desired: 1, Ready: 1/1, Available: 1/1\n    Deployment            cilium-operator          Desired: 1, Ready: 1/1, Available: 1/1\n    Deployment            hubble-relay             Desired: 1, Ready: 1/1, Available: 1/1\n    Containers:           cilium                   Running: 1\n                          cilium-envoy             Running: 1\n                          cilium-operator          Running: 1\n                          clustermesh-apiserver\n                          hubble-relay             Running: 1\n    Cluster Pods:         8/8 managed by Cilium\n    Helm chart version:   1.17.0\n    Image versions        cilium             quay.io/cilium/cilium:latest: 1\n                          cilium-envoy       quay.io/cilium/cilium-envoy:v1.32.3-1739240299-e85e926b0fa4cec519cefff54b60bd7942d7871b@sha256:ced8a89d642d10d648471afc2d8737238f1479c368955e6f2553ded58029ac88: 1\n                          cilium-operator    quay.io/cilium/operator-generic-ci:latest: 1\n                          hubble-relay       quay.io/cilium/hubble-relay-ci:latest: 1\n\nHubble Relay\n------------\n\nIf Hubble Relay is enabled, ``cilium status`` should display: ``OK``.\nOtherwise, we should expect to see errors/warnings reported:\n\n.. code-block:: shell-session\n\n    $ cilium status\n        /¬Ø¬Ø\\\n     /¬Ø¬Ø\\__/¬Ø¬Ø\\    Cilium:             OK\n     \\__/¬Ø¬Ø\\__/    Operator:           OK\n     /¬Ø¬Ø\\__/¬Ø¬Ø\\    Envoy DaemonSet:    OK\n     \\__/¬Ø¬Ø\\__/    Hubble Relay:       1 errors, 2 warnings\n        \\__/       ClusterMesh:        disabled\n\n    DaemonSet              cilium                   Desired: 1, Ready: 1/1, Available: 1/1\n    DaemonSet              cilium-envoy             Desired: 1, Ready: 1/1, Available: 1/1\n    Deployment             cilium-operator          Desired: 1, Ready: 1/1, Available: 1/1\n    Deployment             hubble-relay             Desired: 1, Unavailable: 1/1\n    Containers:            cilium                   Running: 1\n                           cilium-envoy             Running: 1\n                           cilium-operator          Running: 1\n                           clustermesh-apiserver\n                           hubble-relay             Pending: 1\n    Cluster Pods:          8/8 managed by Cilium\n    Helm chart version:    1.17.0\n    Image versions         cilium             quay.io/cilium/cilium:latest: 1\n                           cilium-envoy       quay.io/cilium/cilium-envoy:v1.32.3-1739240299-e85e926b0fa4cec519cefff54b60bd7942d7871b@sha256:ced8a89d642d10d648471afc2d8737238f1479c368955e6f2553ded58029ac88: 1\n                           cilium-operator    quay.io/cilium/operator-generic-ci:latest: 1\n                           hubble-relay       quay.io/cilium/hubble-relay-ci:latest-: 1\n    Errors:                hubble-relay       hubble-relay                     1 pods of Deployment hubble-relay are not ready\n    Warnings:              hubble-relay       hubble-relay-85f98cc7df-s2lkq    pod is pending\n                           hubble-relay       hubble-relay-85f98cc7df-s2lkq    pod is pending\n\n.. tip::\n\n    If warnings or errors are reported for both ``Cilium`` and ``Hubble Relay``, it\n    often hints at a misconfiguration in Hubble or the Hubble system failing to start.\n    Since Hubble is a non-critical system running in the Cilium Agent, it is expected\n    for the Cilium pods to remain running and healthy even when Hubble fails to start.\n    See the :ref:`hubble_setup_troubleshooting` section below for Hubble-specific troubleshooting\n    steps.\n\nVerify the state of the pods with:\n\n.. code-block:: shell-session\n\n    $ kubectl -n kube-system get pods -l k8s-app=hubble-relay\n    NAME                           READY   STATUS             RESTARTS      AGE\n    hubble-relay-6467f4f4d-x825b   0/1     CrashLoopBackOff   5 (19s ago)   7m28s\n\nIf one or more pods are in ``Pending`` state, describe the pod(s) with:\n\n.. code-block:: shell-session\n\n    $ kubectl describe -n kube-system pod/cilium-5bjkq\n    Name:             hubble-relay-6467f4f4d-x825b\n    Namespace:        kube-system\n    ...\n\nIf one or more pods are not in ``Running`` state, look at the pod(s) logs with:\n\n.. code-block:: shell-session\n\n    $ kubectl -n kube-system logs hubble-relay-6467f4f4d-x825b\n    time=\"2025-02-12T21:21:40.246596435Z\" level=info msg=\"Starting gRPC health server...\" addr=\":4222\" subsys=hubble-relay\n    time=\"2025-02-12T21:21:40.246611018Z\" level=info msg=\"Starting gRPC server...\" options=\"{peerTarget:hubble-peer.kube-system.svc.cluster.local.:443 retryTimeout:30000000000 listenAddress::4245 healthListenAddress::4222 metricsListenAddress: log:0x400038fc00 serverTLSConfig:<nil> insecureServer:true clientTLSConfig:0x4000b12528 clusterName:cluster insecureClient:false observerOptions:[0x28cb1e0 0x28cb2e0] grpcMetrics:<nil> grpcUnaryInterceptors:[] grpcStreamInterceptors:[]}\" subsys=hubble-relay\n    time=\"2025-02-12T21:21:40.251658493Z\" level=info msg=\"Failed to create peer notify client for peers change notification; will try again after the timeout has expired\" connection timeout=30s error=\"rpc error: code = Unavailable desc = connection error: desc = \\\"transport: Error while dialing: dial tcp 10.96.49.4:443: connect: connection refused\\\"\" subsys=hubble-relay\n    time=\"2025-02-12T21:22:10.25956541Z\" level=info msg=\"Failed to create peer notify client for peers change notification; will try again after the timeout has expired\" connection timeout=30s error=\"rpc error: code = Unavailable desc = connection error: desc = \\\"transport: Error while dialing: dial tcp 10.96.49.4:443: connect: connection refused\\\"\" subsys=hubble-relay\n    time=\"2025-02-12T21:22:40.265123839Z\" level=info msg=\"Failed to create peer notify client for peers change notification; will try again after the timeout has expired\" connection timeout=30s error=\"rpc error: code = Unavailable desc = connection error: desc = \\\"transport: Error while dialing: dial tcp 10.96.49.4:443: connect: connection refused\\\"\" subsys=hubble-relay\n    time=\"2025-02-12T21:22:49.055746359Z\" level=info msg=\"Stopping server...\" subsys=hubble-relay\n    time=\"2025-02-12T21:22:49.056293486Z\" level=info msg=\"Server stopped\" subsys=hubble-relay\n\nIf you face a ``connection refused`` error, it means that Hubble-Relay can't connect\nto the Hubble API exposed by Cilium agents through the ``hubble-peer`` service.\nSee the :ref:`hubble_setup_troubleshooting` section below for Hubble-specific troubleshooting\nsteps.\n\nFor TLS related errors, see :ref:`Hubble TLS Troubleshooting<hubble_enable_tls_troubleshooting>`.\n\n.. _hubble_setup_troubleshooting:\n\nHubble\n------\n\nIf Hubble is enabled, ``cilium status`` should display: ``OK`` for ``Cilium``.\nOtherwise, we should expect to see errors/warnings reported:\n\n.. code-block:: shell-session\n\n    $ cilium status\n        /¬Ø¬Ø\\\n     /¬Ø¬Ø\\__/¬Ø¬Ø\\    Cilium:             1 warnings\n     \\__/¬Ø¬Ø\\__/    Operator:           OK\n     /¬Ø¬Ø\\__/¬Ø¬Ø\\    Envoy DaemonSet:    OK\n     \\__/¬Ø¬Ø\\__/    Hubble Relay:       1 errors\n        \\__/       ClusterMesh:        disabled\n\n    DaemonSet              cilium                   Desired: 1, Ready: 1/1, Available: 1/1\n    DaemonSet              cilium-envoy             Desired: 1, Ready: 1/1, Available: 1/1\n    Deployment             cilium-operator          Desired: 1, Ready: 1/1, Available: 1/1\n    Deployment             hubble-relay             Desired: 1, Unavailable: 1/1\n    Containers:            cilium                   Running: 1\n                           cilium-envoy             Running: 1\n                           cilium-operator          Running: 1\n                           clustermesh-apiserver\n                           hubble-relay             Running: 1\n    Cluster Pods:          8/8 managed by Cilium\n    Helm chart version:    1.17.0\n    Image versions         cilium             quay.io/cilium/cilium:latest: 1\n                           cilium-envoy       quay.io/cilium/cilium-envoy:v1.32.3-1739240299-e85e926b0fa4cec519cefff54b60bd7942d7871b@sha256:ced8a89d642d10d648471afc2d8737238f1479c368955e6f2553ded58029ac88: 1\n                           cilium-operator    quay.io/cilium/operator-generic-ci:latest: 1\n                           hubble-relay       quay.io/cilium/hubble-relay-ci:latest: 1\n    Errors:                hubble-relay       hubble-relay    1 pods of Deployment hubble-relay are not ready\n    Warnings:              cilium             cilium-5bjkq    Hubble: failed to setup metrics: metric 'unknown-metric' does not exist\n\nVerify the state of the pods with:\n\n.. code-block:: shell-session\n\n    $ kubectl -n kube-system get pods -l k8s-app=cilium\n    NAME           READY   STATUS    RESTARTS      AGE\n    cilium-5bjkq   1/1     Running   1 (18m ago)   33m\n\nIf one or more pods are in ``Pending`` state, describe the pod(s) with:\n\n.. code-block:: shell-session\n\n    $ kubectl describe -n kube-system pod/cilium-5bjkq\n    Name:                 cilium-5bjkq\n    Namespace:            kube-system\n    ...\n\nIf one or more pods are not in ``Running`` state, look at the pod(s) logs with:\n\n.. code-block:: shell-session\n\n    $ kubectl logs -n kube-system -c cilium-agent -l k8s-app=cilium --tail=-1 | grep subsys=hubble\n    time=\"2025-02-12T22:12:01.227357082Z\" level=info msg=\"Starting Hubble Metrics server\" address=\":9965\" metrics=unknown-metric subsys=hubble tls=false\n    time=\"2025-02-12T22:12:01.22740229Z\" level=error msg=\"Failed to launch hubble\" error=\"failed to setup metrics: metric 'unknown-metric' does not exist\" subsys=hubble\n\nNext Steps\n==========\n\n* :ref:`hubble_cli`\n* :ref:`hubble_ui`\n* :ref:`hubble_enable_tls`\n",
  "item_type": "unknown",
  "module_path": "/tmp/cilium-repo/Documentation/observability/hubble/setup.rst",
  "extracted_at": "2025-09-03T01:13:29.328925Z"
}